<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>âš½ é¢„æµ‹æ¥æºè®°å½•éªŒè¯</title>
<style>
/* åŸºç¡€æ ·å¼ */
*{box-sizing:border-box}
body{margin:0;font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,sans-serif;background:#f8fafc;color:#334155;line-height:1.5}
.wrap{width:100%;margin:0;padding:12px}
.row{display:flex;gap:8px;align-items:stretch}
.col{display:flex;flex-direction:column;gap:8px}
.card{background:white;border-radius:8px;padding:16px;box-shadow:0 1px 3px rgba(0,0,0,0.1)}
.small{font-size:13px}
.muted{color:#64748b}

/* å¯¼èˆªæ  */
.navbar{position:sticky;top:0;z-index:10;background:#0f172a;color:#e5e7eb;border-bottom:1px solid rgba(255,255,255,.08);padding:8px 14px;margin-bottom:12px}
.navbar h1{font-size:24px;font-weight:700;color:#f1f5f9;margin:0}
.iconbar{display:flex;gap:10px;align-items:center}
.icon-btn{background:transparent;border:none;padding:4px;color:#e5e7eb;font-size:18px;cursor:pointer;transition:all 0.2s}
.icon-btn:hover{filter:brightness(1.2)}
.icon-btn.active{background:rgba(96,165,250,.18);border-color:#60a5fa;color:#fff}

/* æŒ‰é’®æ ·å¼ */
.btn{background:#3b82f6;color:white;border:none;border-radius:6px;padding:8px 16px;cursor:pointer;font-size:14px;transition:all 0.2s}
.btn:hover{background:#2563eb}
.btn.sec{background:#f1f5f9;color:#475569;border:1px solid #e2e8f0}
.btn.sec:hover{background:#e2e8f0}
.btn.warn{background:#ef4444;color:white}
.btn.warn:hover{background:#dc2626}
.btn:disabled{opacity:0.5;cursor:not-allowed}
.btn-small{padding:4px 8px;font-size:12px;border:1px solid #d1d5db;border-radius:4px;background:#fff;color:#374151;cursor:pointer;transition:all 0.2s}
.btn-small:hover{background:#f9fafb;border-color:#9ca3af}

/* è¡¨å•å…ƒç´  */
input,select,textarea{border:1px solid #d1d5db;border-radius:6px;padding:8px 12px;font-size:14px;width:100%}
input:focus,select:focus,textarea:focus{outline:none;border-color:#3b82f6;box-shadow:0 0 0 3px rgba(59,130,246,0.1)}
.field{display:flex;flex-direction:column;gap:4px}
.field label{font-size:12px;font-weight:500;color:#374151}

/* æ ‡ç­¾é¡µæ ·å¼ */
.tab-nav{display:flex;border-bottom:1px solid #e2e8f0;margin-bottom:16px}
.tab-btn{padding:8px 16px;border:none;background:none;color:#64748b;border-bottom:2px solid transparent;cursor:pointer;font-weight:500;transition:all 0.2s}
.tab-btn:hover{color:#3b82f6;background:#f1f5f9}
.tab-btn.active{color:#3b82f6;border-bottom-color:#3b82f6}
.tab-content{display:none}
.tab-content.active{display:block}

/* æ—¥å†æ ·å¼ */
.calendar{background:white;border-radius:8px;overflow:hidden}
.calendar-header{background:#3b82f6;color:white;padding:16px;display:flex;align-items:center;justify-content:space-between}
.calendar-nav{background:transparent;border:none;color:white;font-size:18px;cursor:pointer;padding:4px 8px;border-radius:4px;transition:all 0.2s}
.calendar-nav:hover{background:rgba(255,255,255,0.1)}
.calendar-grid{display:grid;grid-template-columns:repeat(7,1fr)}
.calendar-day-header{background:#f8fafc;padding:12px 8px;text-align:center;font-weight:600;color:#475569;font-size:12px}
.calendar-day{padding:12px 8px;text-align:center;border:1px solid #f1f5f9;cursor:pointer;transition:all 0.2s;position:relative;min-height:60px;display:flex;flex-direction:column;align-items:center;justify-content:center}
.calendar-day:hover{background:#f8fafc}
.calendar-day.other-month{color:#94a3b8;background:#fafafa}
.calendar-day.today{background:#eff6ff;border-color:#3b82f6;font-weight:600}
.calendar-day.win{background:#dcfce7;color:#166534}
.calendar-day.loss{background:#fee2e2;color:#991b1b}
.calendar-day-number{font-size:14px;margin-bottom:4px}
.calendar-day-status{font-size:10px;padding:2px 4px;border-radius:3px;background:rgba(0,0,0,0.1)}

/* ç»Ÿè®¡å›¾è¡¨æ ·å¼ */
.stats-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:16px;margin-bottom:20px}
.stat-card{background:white;border-radius:8px;padding:16px;text-align:center;box-shadow:0 1px 3px rgba(0,0,0,0.1)}
.stat-number{font-size:24px;font-weight:700;color:#3b82f6;margin-bottom:4px}
.stat-label{font-size:12px;color:#64748b;text-transform:uppercase;letter-spacing:0.5px}
.chart-container{background:white;border-radius:8px;padding:20px;margin-bottom:20px}

/* æ¥æºç®¡ç†æ ·å¼ */
.source-item{border:1px solid #e2e8f0;border-radius:6px;padding:12px;margin-bottom:8px;transition:all 0.2s}
.source-item:hover{border-color:#3b82f6;background:#f8fafc}
.source-header{display:flex;align-items:center;justify-content:space-between;margin-bottom:8px}
.source-name{font-weight:600;color:#1e293b}
.source-description{font-size:12px;color:#64748b;line-height:1.4}
.source-actions{display:flex;gap:4px}

/* å“åº”å¼è®¾è®¡ */
@media(max-width:768px){
  .stats-grid{grid-template-columns:repeat(2,1fr)}
  .calendar-day{min-height:50px;padding:8px 4px}
  .calendar-day-number{font-size:12px}
  .tab-nav{flex-wrap:wrap}
  .tab-btn{flex:1;min-width:120px}
}

@media(max-width:480px){
  .stats-grid{grid-template-columns:1fr}
  .calendar-grid{font-size:12px}
  .calendar-day{min-height:40px;padding:6px 2px}
}
</style>
</head>
<body>

<!-- å¯¼èˆªæ  -->
<div class="navbar">
  <div class="wrap">
    <div class="row" style="align-items:center;gap:12px">
      <h1>ğŸ“Š é¢„æµ‹æ¥æºè®°å½•éªŒè¯</h1>
      <div class="iconbar">
        <button class="icon-btn" title="å•åœºå½©" onclick="window.location.href='index.html'">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><path d="M12 6v6l4 2"/></svg>
        </button>
        <button class="icon-btn" title="å¤šé‡å½©" onclick="window.location.href='multi-bet.html'">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="3" width="18" height="18" rx="2" ry="2"/><path d="M9 9h6v6H9z"/><path d="M9 3v6"/><path d="M21 9h-6"/><path d="M15 21v-6"/><path d="M3 15h6"/></svg>
        </button>
        <button class="icon-btn active" title="é¢„æµ‹æ¥æºè®°å½•éªŒè¯">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M9 11H5a2 2 0 0 0-2 2v3a2 2 0 0 0 2 2h4"/><path d="M20 16V7a2 2 0 0 0-2-2H9a2 2 0 0 0-2 2v1"/><path d="M15 2v5"/><path d="M9 2v5"/><path d="M3 9h18"/><circle cx="16" cy="16" r="2"/><path d="m21 21-1.5-1.5"/></svg>
        </button>
      </div>
    </div>
  </div>
</div>

<!-- ä¸»è¦å†…å®¹åŒºåŸŸ -->
<div class="wrap">
  <div class="card">
    <!-- æ ‡ç­¾é¡µå¯¼èˆª -->
    <div class="tab-nav">
      <button class="tab-btn active" data-tab="sources">ğŸ“ é¢„æµ‹æ¥æºç®¡ç†</button>
      <button class="tab-btn" data-tab="calendar">ğŸ“… æ—¥å†è®°å½•</button>
      <button class="tab-btn" data-tab="statistics">ğŸ“Š ç»Ÿè®¡æŠ¥è¡¨</button>
    </div>

    <!-- é¢„æµ‹æ¥æºç®¡ç†æ ‡ç­¾é¡µ -->
    <div class="tab-content active" id="sources">
      <div class="row" style="gap:16px">
        <!-- å·¦ä¾§ï¼šæ·»åŠ æ–°æ¥æº -->
        <div class="col" style="flex:1">
          <div class="card">
            <h3 style="margin:0 0 16px;color:#334155">â• æ·»åŠ æ–°é¢„æµ‹æ¥æº</h3>
            <div class="field" style="margin-bottom:12px">
              <label>æ¥æºåç§° <span style="color:#ef4444">*</span></label>
              <input id="sourceName" placeholder="å¦‚ï¼šä¸“å®¶Aã€ç½‘ç«™Bã€è‡ªå·±åˆ†æç­‰">
            </div>
            <div class="field" style="margin-bottom:16px">
              <label>è¯¦ç»†è¯´æ˜</label>
              <textarea id="sourceDescription" rows="4" placeholder="æè¿°è¯¥é¢„æµ‹æ¥æºçš„ç‰¹ç‚¹ã€å‡†ç¡®ç‡ã€åˆ†ææ–¹æ³•ç­‰è¯¦ç»†ä¿¡æ¯..."></textarea>
            </div>
            <div class="row">
              <button id="addSourceBtn" class="btn">ä¿å­˜æ¥æº</button>
              <button id="clearSourceForm" class="btn sec">æ¸…ç©º</button>
            </div>
          </div>
        </div>
        
        <!-- å³ä¾§ï¼šç°æœ‰æ¥æºåˆ—è¡¨ -->
        <div class="col" style="flex:2">
          <div class="card">
            <h3 style="margin:0 0 16px;color:#334155">ğŸ“‹ ç°æœ‰é¢„æµ‹æ¥æº</h3>
            <div id="sourcesList">
              <!-- æ¥æºåˆ—è¡¨å°†åœ¨è¿™é‡ŒåŠ¨æ€ç”Ÿæˆ -->
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- æ—¥å†è®°å½•æ ‡ç­¾é¡µ -->
    <div class="tab-content" id="calendar">
      <div class="row" style="gap:16px;margin-bottom:16px">
        <div class="field" style="flex:1">
          <label>é€‰æ‹©é¢„æµ‹æ¥æº</label>
          <select id="calendarSourceSelect">
            <option value="">è¯·é€‰æ‹©é¢„æµ‹æ¥æº</option>
          </select>
        </div>
        <div class="field" style="flex:1">
          <label>å¿«é€Ÿæ“ä½œ</label>
          <div class="row">
            <button id="markWinBtn" class="btn" style="background:#22c55e">æ ‡è®°ä»Šæ—¥ä¸ºèµ¢</button>
            <button id="markLossBtn" class="btn" style="background:#ef4444">æ ‡è®°ä»Šæ—¥ä¸ºè¾“</button>
          </div>
        </div>
      </div>
      
      <div class="calendar" id="calendar">
        <div class="calendar-header">
          <button class="calendar-nav" id="prevMonth">â€¹</button>
          <h3 id="currentMonth" style="margin:0;font-size:18px">2024å¹´1æœˆ</h3>
          <button class="calendar-nav" id="nextMonth">â€º</button>
        </div>
        <div class="calendar-grid" id="calendarGrid">
          <!-- æ—¥å†ç½‘æ ¼å°†åœ¨è¿™é‡ŒåŠ¨æ€ç”Ÿæˆ -->
        </div>
      </div>
    </div>

    <!-- ç»Ÿè®¡æŠ¥è¡¨æ ‡ç­¾é¡µ -->
    <div class="tab-content" id="statistics">
      <div class="row" style="margin-bottom:16px">
        <div class="field" style="flex:1">
          <label>é€‰æ‹©é¢„æµ‹æ¥æº</label>
          <select id="statsSourceSelect">
            <option value="">è¯·é€‰æ‹©é¢„æµ‹æ¥æº</option>
          </select>
        </div>
        <div class="field" style="flex:1">
          <label>ç»Ÿè®¡æ—¶é—´èŒƒå›´</label>
          <select id="statsTimeRange">
            <option value="30">æœ€è¿‘30å¤©</option>
            <option value="90">æœ€è¿‘90å¤©</option>
            <option value="180">æœ€è¿‘åŠå¹´</option>
            <option value="365">æœ€è¿‘ä¸€å¹´</option>
            <option value="all">å…¨éƒ¨æ—¶é—´</option>
          </select>
        </div>
      </div>
      
      <!-- ç»Ÿè®¡å¡ç‰‡ -->
      <div class="stats-grid" id="statsGrid">
        <div class="stat-card">
          <div class="stat-number" id="totalDays">0</div>
          <div class="stat-label">æ€»é¢„æµ‹å¤©æ•°</div>
        </div>
        <div class="stat-card">
          <div class="stat-number" id="winDays">0</div>
          <div class="stat-label">é¢„æµ‹æ­£ç¡®å¤©æ•°</div>
        </div>
        <div class="stat-card">
          <div class="stat-number" id="lossDays">0</div>
          <div class="stat-label">é¢„æµ‹é”™è¯¯å¤©æ•°</div>
        </div>
        <div class="stat-card">
          <div class="stat-number" id="winRate">0%</div>
          <div class="stat-label">é¢„æµ‹å‡†ç¡®ç‡</div>
        </div>
        <div class="stat-card">
          <div class="stat-number" id="currentStreak">0</div>
          <div class="stat-label">å½“å‰è¿ç»­å¤©æ•°</div>
        </div>
        <div class="stat-card">
          <div class="stat-number" id="bestStreak">0</div>
          <div class="stat-label">æœ€ä½³è¿èƒœè®°å½•</div>
        </div>
      </div>
      
      <!-- å›¾è¡¨å®¹å™¨ -->
      <div class="chart-container">
        <h4 style="margin:0 0 16px;color:#334155">ğŸ“ˆ é¢„æµ‹è¶‹åŠ¿å›¾</h4>
        <div id="trendChart" style="height:300px;display:flex;align-items:center;justify-content:center;color:#64748b">
          è¯·é€‰æ‹©é¢„æµ‹æ¥æºæŸ¥çœ‹è¶‹åŠ¿å›¾
        </div>
      </div>
      
      <div class="chart-container">
        <h4 style="margin:0 0 16px;color:#334155">ğŸ“Š è¿èƒœè¿è´¥åˆ†æ</h4>
        <div id="streakChart" style="height:200px;display:flex;align-items:center;justify-content:center;color:#64748b">
          è¯·é€‰æ‹©é¢„æµ‹æ¥æºæŸ¥çœ‹è¿èƒœè¿è´¥åˆ†æ
        </div>
      </div>
    </div>
  </div>
</div>

<script>
// å…¨å±€å˜é‡
let predictionSources = JSON.parse(localStorage.getItem('predictionSources') || '[]');
let predictionRecords = JSON.parse(localStorage.getItem('predictionRecords') || '{}');
let currentDate = new Date();
let selectedSource = null;

// å·¥å…·å‡½æ•°
function $(selector) {
  return document.querySelector(selector);
}

function $$(selector) {
  return document.querySelectorAll(selector);
}

function formatDate(date) {
  return date.getFullYear() + '-' + 
         String(date.getMonth() + 1).padStart(2, '0') + '-' + 
         String(date.getDate()).padStart(2, '0');
}

function saveData() {
  localStorage.setItem('predictionSources', JSON.stringify(predictionSources));
  localStorage.setItem('predictionRecords', JSON.stringify(predictionRecords));
}

// æ ‡ç­¾é¡µåˆ‡æ¢
function initTabs() {
  $$('.tab-btn').forEach(btn => {
    btn.addEventListener('click', () => {
      const tabId = btn.dataset.tab;
      
      // æ›´æ–°æŒ‰é’®çŠ¶æ€
      $$('.tab-btn').forEach(b => b.classList.remove('active'));
      btn.classList.add('active');
      
      // æ›´æ–°å†…å®¹æ˜¾ç¤º
      $$('.tab-content').forEach(content => {
        content.classList.remove('active');
      });
      $('#' + tabId).classList.add('active');
      
      // æ ¹æ®æ ‡ç­¾é¡µæ‰§è¡Œç›¸åº”çš„åˆå§‹åŒ–
      if (tabId === 'sources') {
        renderSourcesList();
      } else if (tabId === 'calendar') {
        updateSourceSelects();
        renderCalendar();
      } else if (tabId === 'statistics') {
        updateSourceSelects();
        updateStatistics();
      }
    });
  });
}

// é¢„æµ‹æ¥æºç®¡ç†
function initSourcesManagement() {
  $('#addSourceBtn').addEventListener('click', addSource);
  $('#clearSourceForm').addEventListener('click', clearSourceForm);
  renderSourcesList();
}

function addSource() {
  const name = $('#sourceName').value.trim();
  const description = $('#sourceDescription').value.trim();
  
  if (!name) {
    alert('è¯·è¾“å…¥æ¥æºåç§°');
    return;
  }
  
  // æ£€æŸ¥æ˜¯å¦å·²å­˜åœ¨åŒåæ¥æº
  if (predictionSources.some(source => source.name === name)) {
    alert('è¯¥æ¥æºåç§°å·²å­˜åœ¨ï¼Œè¯·ä½¿ç”¨å…¶ä»–åç§°');
    return;
  }
  
  const newSource = {
    id: Date.now(),
    name: name,
    description: description,
    createdAt: new Date().toISOString()
  };
  
  predictionSources.push(newSource);
  saveData();
  renderSourcesList();
  updateSourceSelects();
  clearSourceForm();
  
  alert('é¢„æµ‹æ¥æºæ·»åŠ æˆåŠŸï¼');
}

function clearSourceForm() {
  $('#sourceName').value = '';
  $('#sourceDescription').value = '';
}

function renderSourcesList() {
  const container = $('#sourcesList');
  
  if (predictionSources.length === 0) {
    container.innerHTML = '<div style="text-align:center;padding:40px;color:#64748b">æš‚æ— é¢„æµ‹æ¥æº<br><small>è¯·å…ˆæ·»åŠ é¢„æµ‹æ¥æº</small></div>';
    return;
  }
  
  container.innerHTML = predictionSources.map(source => `
    <div class="source-item">
      <div class="source-header">
        <div class="source-name">${source.name}</div>
        <div class="source-actions">
          <button class="btn-small" onclick="editSource(${source.id})">ç¼–è¾‘</button>
          <button class="btn-small warn" onclick="deleteSource(${source.id})">åˆ é™¤</button>
        </div>
      </div>
      ${source.description ? `<div class="source-description">${source.description}</div>` : ''}
      <div class="small muted" style="margin-top:8px">åˆ›å»ºæ—¶é—´ï¼š${new Date(source.createdAt).toLocaleString()}</div>
    </div>
  `).join('');
}

function editSource(id) {
  const source = predictionSources.find(s => s.id === id);
  if (!source) return;
  
  const newName = prompt('è¯·è¾“å…¥æ–°çš„æ¥æºåç§°ï¼š', source.name);
  if (newName === null) return;
  
  if (!newName.trim()) {
    alert('æ¥æºåç§°ä¸èƒ½ä¸ºç©º');
    return;
  }
  
  // æ£€æŸ¥æ˜¯å¦ä¸å…¶ä»–æ¥æºé‡å
  if (predictionSources.some(s => s.id !== id && s.name === newName.trim())) {
    alert('è¯¥æ¥æºåç§°å·²å­˜åœ¨ï¼Œè¯·ä½¿ç”¨å…¶ä»–åç§°');
    return;
  }
  
  const newDescription = prompt('è¯·è¾“å…¥æ–°çš„è¯¦ç»†è¯´æ˜ï¼š', source.description || '');
  if (newDescription === null) return;
  
  source.name = newName.trim();
  source.description = newDescription.trim();
  
  saveData();
  renderSourcesList();
  updateSourceSelects();
  
  alert('é¢„æµ‹æ¥æºæ›´æ–°æˆåŠŸï¼');
}

function deleteSource(id) {
  const source = predictionSources.find(s => s.id === id);
  if (!source) return;
  
  if (!confirm(`ç¡®å®šè¦åˆ é™¤é¢„æµ‹æ¥æº"${source.name}"å—ï¼Ÿ\n\næ³¨æ„ï¼šåˆ é™¤åè¯¥æ¥æºçš„æ‰€æœ‰é¢„æµ‹è®°å½•ä¹Ÿå°†è¢«åˆ é™¤ï¼Œæ­¤æ“ä½œä¸å¯æ¢å¤ï¼`)) {
    return;
  }
  
  // åˆ é™¤æ¥æº
  predictionSources = predictionSources.filter(s => s.id !== id);
  
  // åˆ é™¤ç›¸å…³çš„é¢„æµ‹è®°å½•
  Object.keys(predictionRecords).forEach(date => {
    if (predictionRecords[date][id]) {
      delete predictionRecords[date][id];
      if (Object.keys(predictionRecords[date]).length === 0) {
        delete predictionRecords[date];
      }
    }
  });
  
  saveData();
  renderSourcesList();
  updateSourceSelects();
  renderCalendar();
  updateStatistics();
  
  alert('é¢„æµ‹æ¥æºåˆ é™¤æˆåŠŸï¼');
}

// æ›´æ–°æ¥æºé€‰æ‹©ä¸‹æ‹‰æ¡†
function updateSourceSelects() {
  const selects = ['#calendarSourceSelect', '#statsSourceSelect'];
  
  selects.forEach(selector => {
    const select = $(selector);
    if (!select) return;
    
    const currentValue = select.value;
    select.innerHTML = '<option value="">è¯·é€‰æ‹©é¢„æµ‹æ¥æº</option>' + 
      predictionSources.map(source => 
        `<option value="${source.id}">${source.name}</option>`
      ).join('');
    
    // æ¢å¤ä¹‹å‰çš„é€‰æ‹©
    if (currentValue && predictionSources.some(s => s.id == currentValue)) {
      select.value = currentValue;
    }
  });
}

// æ—¥å†åŠŸèƒ½
function initCalendar() {
  $('#prevMonth').addEventListener('click', () => {
    currentDate.setMonth(currentDate.getMonth() - 1);
    renderCalendar();
  });
  
  $('#nextMonth').addEventListener('click', () => {
    currentDate.setMonth(currentDate.getMonth() + 1);
    renderCalendar();
  });
  
  $('#calendarSourceSelect').addEventListener('change', (e) => {
    selectedSource = e.target.value ? parseInt(e.target.value) : null;
    renderCalendar();
  });
  
  $('#markWinBtn').addEventListener('click', () => markToday('win'));
  $('#markLossBtn').addEventListener('click', () => markToday('loss'));
  
  renderCalendar();
}

function markToday(result) {
  if (!selectedSource) {
    alert('è¯·å…ˆé€‰æ‹©é¢„æµ‹æ¥æº');
    return;
  }
  
  const today = formatDate(new Date());
  setDayResult(today, selectedSource, result);
  renderCalendar();
  updateStatistics();
}

function renderCalendar() {
  const year = currentDate.getFullYear();
  const month = currentDate.getMonth();
  
  // æ›´æ–°æœˆä»½æ ‡é¢˜
  $('#currentMonth').textContent = `${year}å¹´${month + 1}æœˆ`;
  
  // è·å–æœˆä»½ä¿¡æ¯
  const firstDay = new Date(year, month, 1);
  const lastDay = new Date(year, month + 1, 0);
  const startDate = new Date(firstDay);
  startDate.setDate(startDate.getDate() - firstDay.getDay());
  
  const grid = $('#calendarGrid');
  grid.innerHTML = '';
  
  // æ·»åŠ æ˜ŸæœŸæ ‡é¢˜
  const weekdays = ['æ—¥', 'ä¸€', 'äºŒ', 'ä¸‰', 'å››', 'äº”', 'å…­'];
  weekdays.forEach(day => {
    const header = document.createElement('div');
    header.className = 'calendar-day-header';
    header.textContent = day;
    grid.appendChild(header);
  });
  
  // æ·»åŠ æ—¥æœŸ
  const today = new Date();
  const todayStr = formatDate(today);
  
  for (let i = 0; i < 42; i++) {
    const date = new Date(startDate);
    date.setDate(startDate.getDate() + i);
    const dateStr = formatDate(date);
    
    const dayElement = document.createElement('div');
    dayElement.className = 'calendar-day';
    
    // æ·»åŠ æ ·å¼ç±»
    if (date.getMonth() !== month) {
      dayElement.classList.add('other-month');
    }
    if (dateStr === todayStr) {
      dayElement.classList.add('today');
    }
    
    // è·å–è¯¥æ—¥æœŸçš„é¢„æµ‹ç»“æœ
    let dayResult = null;
    if (selectedSource && predictionRecords[dateStr] && predictionRecords[dateStr][selectedSource]) {
      dayResult = predictionRecords[dateStr][selectedSource];
      dayElement.classList.add(dayResult);
    }
    
    // æ·»åŠ æ—¥æœŸå†…å®¹
    dayElement.innerHTML = `
      <div class="calendar-day-number">${date.getDate()}</div>
      ${dayResult ? `<div class="calendar-day-status">${dayResult === 'win' ? 'èµ¢' : 'è¾“'}</div>` : ''}
    `;
    
    // æ·»åŠ ç‚¹å‡»äº‹ä»¶
    dayElement.addEventListener('click', () => {
      if (!selectedSource) {
        alert('è¯·å…ˆé€‰æ‹©é¢„æµ‹æ¥æº');
        return;
      }
      
      const currentResult = predictionRecords[dateStr] && predictionRecords[dateStr][selectedSource];
      let newResult;
      
      if (!currentResult) {
        newResult = 'win';
      } else if (currentResult === 'win') {
        newResult = 'loss';
      } else {
        newResult = null; // æ¸…é™¤è®°å½•
      }
      
      setDayResult(dateStr, selectedSource, newResult);
      renderCalendar();
      updateStatistics();
    });
    
    grid.appendChild(dayElement);
  }
}

function setDayResult(dateStr, sourceId, result) {
  if (!predictionRecords[dateStr]) {
    predictionRecords[dateStr] = {};
  }
  
  if (result === null) {
    delete predictionRecords[dateStr][sourceId];
    if (Object.keys(predictionRecords[dateStr]).length === 0) {
      delete predictionRecords[dateStr];
    }
  } else {
    predictionRecords[dateStr][sourceId] = result;
  }
  
  saveData();
}

// ç»Ÿè®¡åŠŸèƒ½
function initStatistics() {
  $('#statsSourceSelect').addEventListener('change', updateStatistics);
  $('#statsTimeRange').addEventListener('change', updateStatistics);
  updateStatistics();
}

function updateStatistics() {
  const sourceId = $('#statsSourceSelect').value;
  const timeRange = $('#statsTimeRange').value;
  
  if (!sourceId) {
    // æ¸…ç©ºç»Ÿè®¡æ˜¾ç¤º
    $('#totalDays').textContent = '0';
    $('#winDays').textContent = '0';
    $('#lossDays').textContent = '0';
    $('#winRate').textContent = '0%';
    $('#currentStreak').textContent = '0';
    $('#bestStreak').textContent = '0';
    $('#trendChart').innerHTML = 'è¯·é€‰æ‹©é¢„æµ‹æ¥æºæŸ¥çœ‹è¶‹åŠ¿å›¾';
    $('#streakChart').innerHTML = 'è¯·é€‰æ‹©é¢„æµ‹æ¥æºæŸ¥çœ‹è¿èƒœè¿è´¥åˆ†æ';
    return;
  }
  
  // è·å–æ—¶é—´èŒƒå›´
  const endDate = new Date();
  let startDate;
  if (timeRange === 'all') {
    startDate = new Date('2020-01-01'); // è¶³å¤Ÿæ—©çš„æ—¥æœŸ
  } else {
    startDate = new Date();
    startDate.setDate(startDate.getDate() - parseInt(timeRange));
  }
  
  // æ”¶é›†è¯¥æ¥æºåœ¨æ—¶é—´èŒƒå›´å†…çš„è®°å½•
  const records = [];
  Object.keys(predictionRecords).forEach(dateStr => {
    const date = new Date(dateStr);
    if (date >= startDate && date <= endDate && predictionRecords[dateStr][sourceId]) {
      records.push({
        date: dateStr,
        result: predictionRecords[dateStr][sourceId]
      });
    }
  });
  
  // æŒ‰æ—¥æœŸæ’åº
  records.sort((a, b) => a.date.localeCompare(b.date));
  
  // è®¡ç®—ç»Ÿè®¡æ•°æ®
  const totalDays = records.length;
  const winDays = records.filter(r => r.result === 'win').length;
  const lossDays = records.filter(r => r.result === 'loss').length;
  const winRate = totalDays > 0 ? Math.round((winDays / totalDays) * 100) : 0;
  
  // è®¡ç®—è¿èƒœè¿è´¥
  let currentStreak = 0;
  let bestWinStreak = 0;
  let bestLossStreak = 0;
  let tempWinStreak = 0;
  let tempLossStreak = 0;
  
  for (let i = records.length - 1; i >= 0; i--) {
    const result = records[i].result;
    
    // è®¡ç®—å½“å‰è¿ç»­ï¼ˆä»æœ€æ–°è®°å½•å¼€å§‹ï¼‰
    if (i === records.length - 1) {
      currentStreak = 1;
    } else if (records[i + 1].result === result) {
      currentStreak++;
    } else {
      break;
    }
  }
  
  // è®¡ç®—æœ€ä½³è¿èƒœè¿è´¥
  records.forEach(record => {
    if (record.result === 'win') {
      tempWinStreak++;
      tempLossStreak = 0;
      bestWinStreak = Math.max(bestWinStreak, tempWinStreak);
    } else {
      tempLossStreak++;
      tempWinStreak = 0;
      bestLossStreak = Math.max(bestLossStreak, tempLossStreak);
    }
  });
  
  // æ›´æ–°æ˜¾ç¤º
  $('#totalDays').textContent = totalDays;
  $('#winDays').textContent = winDays;
  $('#lossDays').textContent = lossDays;
  $('#winRate').textContent = winRate + '%';
  
  // æ˜¾ç¤ºå½“å‰è¿ç»­çŠ¶æ€
  if (records.length > 0) {
    const lastResult = records[records.length - 1].result;
    $('#currentStreak').textContent = currentStreak + (lastResult === 'win' ? 'è¿èƒœ' : 'è¿è´¥');
  } else {
    $('#currentStreak').textContent = '0';
  }
  
  $('#bestStreak').textContent = Math.max(bestWinStreak, bestLossStreak) + (bestWinStreak >= bestLossStreak ? 'è¿èƒœ' : 'è¿è´¥');
  
  // æ›´æ–°å›¾è¡¨
  updateCharts(records);
}

function updateCharts(records) {
  // ç®€å•çš„æ–‡æœ¬å›¾è¡¨æ˜¾ç¤º
  const trendChart = $('#trendChart');
  const streakChart = $('#streakChart');
  
  if (records.length === 0) {
    trendChart.innerHTML = 'æš‚æ— æ•°æ®';
    streakChart.innerHTML = 'æš‚æ— æ•°æ®';
    return;
  }
  
  // è¶‹åŠ¿å›¾ï¼šæ˜¾ç¤ºæœ€è¿‘çš„è®°å½•
  const recentRecords = records.slice(-30); // æœ€è¿‘30æ¡è®°å½•
  const trendHtml = recentRecords.map(record => {
    const color = record.result === 'win' ? '#22c55e' : '#ef4444';
    const symbol = record.result === 'win' ? 'â—' : 'â—';
    return `<span style="color:${color};margin:0 2px;font-size:16px" title="${record.date}: ${record.result === 'win' ? 'èµ¢' : 'è¾“'}">${symbol}</span>`;
  }).join('');
  
  trendChart.innerHTML = `
    <div style="text-align:center">
      <div style="margin-bottom:10px;color:#64748b;font-size:12px">æœ€è¿‘${recentRecords.length}å¤©é¢„æµ‹ç»“æœï¼ˆç»¿è‰²=èµ¢ï¼Œçº¢è‰²=è¾“ï¼‰</div>
      <div style="line-height:1.5">${trendHtml}</div>
    </div>
  `;
  
  // è¿èƒœè¿è´¥åˆ†æ
  const streaks = [];
  let currentStreak = { type: records[0].result, count: 1, start: records[0].date };
  
  for (let i = 1; i < records.length; i++) {
    if (records[i].result === currentStreak.type) {
      currentStreak.count++;
    } else {
      currentStreak.end = records[i - 1].date;
      streaks.push(currentStreak);
      currentStreak = { type: records[i].result, count: 1, start: records[i].date };
    }
  }
  currentStreak.end = records[records.length - 1].date;
  streaks.push(currentStreak);
  
  // æ˜¾ç¤ºæœ€é•¿çš„å‡ ä¸ªè¿èƒœè¿è´¥
  const topStreaks = streaks
    .sort((a, b) => b.count - a.count)
    .slice(0, 5)
    .map(streak => {
      const color = streak.type === 'win' ? '#22c55e' : '#ef4444';
      const text = streak.type === 'win' ? 'è¿èƒœ' : 'è¿è´¥';
      return `<div style="margin:4px 0;padding:4px 8px;background:${color}20;border-left:3px solid ${color};border-radius:3px">
        <strong>${streak.count}${text}</strong> 
        <span style="color:#64748b;font-size:12px">(${streak.start} ~ ${streak.end})</span>
      </div>`;
    }).join('');
  
  streakChart.innerHTML = topStreaks || '<div style="color:#64748b">æš‚æ— è¿èƒœè¿è´¥è®°å½•</div>';
}

// åˆå§‹åŒ–
document.addEventListener('DOMContentLoaded', function() {
  initTabs();
  initSourcesManagement();
  initCalendar();
  initStatistics();
  updateSourceSelects();
});
</script>

</body>
</html>