<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>âš½ é¢„æµ‹æ¥æºè®°å½•éªŒè¯</title>
<style>
/* åŸºç¡€æ ·å¼ */
*{box-sizing:border-box}
body{margin:0;font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,sans-serif;background:#f8fafc;color:#334155;line-height:1.5}
.wrap{width:100%;margin:0;padding:12px}
.row{display:flex;gap:8px;align-items:stretch}
.col{display:flex;flex-direction:column;gap:8px}
.card{background:white;border-radius:8px;padding:16px;box-shadow:0 1px 3px rgba(0,0,0,0.1)}
.small{font-size:13px}
.muted{color:#64748b}

/* å¯¼èˆªæ  */
.navbar{position:sticky;top:0;z-index:10;background:#0f172a;color:#e5e7eb;border-bottom:1px solid rgba(255,255,255,.08);padding:8px 14px;margin-bottom:12px}
.navbar h1{font-size:24px;font-weight:700;color:#f1f5f9;margin:0}
.iconbar{display:flex;gap:10px;align-items:center}
.icon-btn{background:transparent;border:none;padding:4px;color:#e5e7eb;font-size:18px;cursor:pointer;transition:all 0.2s}
.icon-btn:hover{filter:brightness(1.2)}
.icon-btn.active{background:rgba(96,165,250,.18);border-color:#60a5fa;color:#fff}

/* æŒ‰é’®æ ·å¼ */
.btn{background:#3b82f6;color:white;border:none;border-radius:6px;padding:8px 16px;cursor:pointer;font-size:14px;transition:all 0.2s}
.btn:hover{background:#2563eb}
.btn.sec{background:#f1f5f9;color:#475569;border:1px solid #e2e8f0}
.btn.sec:hover{background:#e2e8f0}
.btn.warn{background:#ef4444;color:white}
.btn.warn:hover{background:#dc2626}
.btn:disabled{opacity:0.5;cursor:not-allowed}
.btn-small{padding:4px 8px;font-size:12px;border:1px solid #d1d5db;border-radius:4px;background:#fff;color:#374151;cursor:pointer;transition:all 0.2s}
.btn-small:hover{background:#f9fafb;border-color:#9ca3af}

/* è¡¨å•å…ƒç´  */
input,select,textarea{border:1px solid #d1d5db;border-radius:6px;padding:8px 12px;font-size:14px;width:100%}
input:focus,select:focus,textarea:focus{outline:none;border-color:#3b82f6;box-shadow:0 0 0 3px rgba(59,130,246,0.1)}
.field{display:flex;flex-direction:column;gap:4px}
.field label{font-size:12px;font-weight:500;color:#374151}

/* æ ‡ç­¾é¡µæ ·å¼ */
.tab-nav{display:flex;border-bottom:1px solid #e2e8f0;margin-bottom:16px}
.tab-btn{padding:8px 16px;border:none;background:none;color:#64748b;border-bottom:2px solid transparent;cursor:pointer;font-weight:500;transition:all 0.2s}
.tab-btn:hover{color:#3b82f6;background:#f1f5f9}
.tab-btn.active{color:#3b82f6;border-bottom-color:#3b82f6}
.tab-content{display:none}
.tab-content.active{display:block}

/* æ—¥å†æ ·å¼ */
.calendar{background:linear-gradient(135deg, #667eea 0%, #764ba2 100%);border-radius:12px;overflow:hidden;box-shadow:0 8px 32px rgba(0,0,0,0.12);border:1px solid rgba(255,255,255,0.1)}
.calendar-header{background:linear-gradient(135deg, #2d3748 0%, #4a5568 100%);color:#f7fafc;padding:18px 20px;display:flex;align-items:center;justify-content:space-between;box-shadow:0 2px 8px rgba(0,0,0,0.1)}
.calendar-nav{background:rgba(255,255,255,0.1);border:1px solid rgba(255,255,255,0.2);color:#f7fafc;font-size:16px;cursor:pointer;padding:8px 12px;border-radius:6px;transition:all 0.3s ease;font-weight:500}
.calendar-nav:hover{background:rgba(255,255,255,0.2);transform:translateY(-1px);box-shadow:0 4px 12px rgba(0,0,0,0.15)}
.calendar-grid{display:grid;grid-template-columns:repeat(7,1fr);background:#ffffff}
.calendar-day-header{background:linear-gradient(135deg, #edf2f7 0%, #e2e8f0 100%);padding:14px 8px;text-align:center;font-weight:700;color:#2d3748;font-size:11px;text-transform:uppercase;letter-spacing:0.5px;border-bottom:2px solid #cbd5e0}
.calendar-day{padding:14px 8px;text-align:center;border:1px solid #e2e8f0;cursor:pointer;transition:all 0.3s ease;position:relative;min-height:65px;display:flex;flex-direction:column;align-items:center;justify-content:center;background:#ffffff}
.calendar-day:hover{background:linear-gradient(135deg, #f7fafc 0%, #edf2f7 100%);transform:translateY(-2px);box-shadow:0 4px 16px rgba(0,0,0,0.08);border-color:#a0aec0}
.calendar-day.other-month{color:#a0aec0;background:#f8f9fa;opacity:0.6}
.calendar-day.today{background:linear-gradient(135deg, #ebf8ff 0%, #bee3f8 100%);border:2px solid #3182ce;font-weight:700;color:#1a365d;box-shadow:0 0 0 3px rgba(49,130,206,0.1)}
.calendar-day.win{background:transparent;color:#2d3748;border:1px solid #d1d5db;font-weight:600;box-shadow:none;position:relative;transform:none}
.calendar-day.win::after{content:'èƒœ';position:absolute;top:50%;right:8px;transform:translateY(-50%);font-size:12px;background:#16a34a;color:white;padding:2px 6px;border-radius:6px;font-weight:700}
.calendar-day.loss{background:transparent;color:#2d3748;border:1px solid #d1d5db;font-weight:600;box-shadow:none;position:relative;transform:none}
.calendar-day.loss::after{content:'è´Ÿ';position:absolute;top:50%;right:8px;transform:translateY(-50%);font-size:12px;background:#dc2626;color:white;padding:2px 6px;border-radius:6px;font-weight:700}
.calendar-day-number{font-size:15px;margin-bottom:4px;font-weight:600}
.calendar-day-status{font-size:10px;padding:3px 6px;border-radius:4px;background:rgba(45,55,72,0.1);color:#2d3748;font-weight:500;text-transform:uppercase;letter-spacing:0.3px}



/* æ¥æºç®¡ç†æ ·å¼ */
.source-item{border:1px solid #e2e8f0;border-radius:6px;padding:12px;margin-bottom:8px;transition:all 0.2s}
.source-item:hover{border-color:#3b82f6;background:#f8fafc}
.source-header{display:flex;align-items:center;justify-content:space-between;margin-bottom:8px}
.source-name{font-weight:600;color:#1e293b}
.source-description{font-size:12px;color:#64748b;line-height:1.4}
.source-actions{display:flex;gap:4px}

/* æ¥æºæŒ‰é’®æ ·å¼ */
.source-btn{background:linear-gradient(135deg, #f7fafc 0%, #edf2f7 100%);color:#2d3748;border:1px solid #cbd5e0;border-radius:8px;padding:10px 18px;cursor:pointer;font-size:14px;transition:all 0.3s ease;font-weight:600;box-shadow:0 2px 4px rgba(0,0,0,0.05);position:relative}
.source-btn:hover{background:linear-gradient(135deg, #e2e8f0 0%, #cbd5e0 100%);border-color:#a0aec0;transform:translateY(-1px);box-shadow:0 4px 8px rgba(0,0,0,0.1)}
.source-btn.active{background:linear-gradient(135deg, #667eea 0%, #764ba2 100%);color:#ffffff;border-color:#667eea;box-shadow:0 4px 12px rgba(102,126,234,0.3)}

/* è¯„çº§ä¸‹åˆ’çº¿æ ·å¼ */
.source-btn::after{content:'';position:absolute;bottom:-2px;left:0;right:0;height:3px;border-radius:0 0 6px 6px;transition:all 0.2s ease}
.source-btn.rating-1::after{background:linear-gradient(90deg, #9ca3af, #6b7280)}
.source-btn.rating-2::after{background:linear-gradient(90deg, #6b7280, #4b5563)}
.source-btn.rating-3::after{background:linear-gradient(90deg, #4b5563, #374151)}
.source-btn.rating-4::after{background:linear-gradient(90deg, #22c55e, #16a34a)}
.source-btn.rating-5::after{background:linear-gradient(90deg, #8b5cf6, #7c3aed)}

/* å¤šæœˆå†æ ·å¼ */
.month-calendar{background:linear-gradient(135deg, #667eea 0%, #764ba2 100%);border-radius:10px;overflow:hidden;margin-bottom:18px;box-shadow:0 6px 24px rgba(0,0,0,0.1);border:1px solid rgba(255,255,255,0.1)}
.month-calendar:last-child{margin-bottom:0}
.month-calendar-header{background:linear-gradient(135deg, #2d3748 0%, #4a5568 100%);color:#f7fafc;padding:14px 18px;font-size:15px;font-weight:700;text-align:center;box-shadow:0 2px 6px rgba(0,0,0,0.1)}
.month-calendar-grid{display:grid;grid-template-columns:repeat(7,1fr);background:#ffffff}
.month-calendar-day-header{background:linear-gradient(135deg, #edf2f7 0%, #e2e8f0 100%);padding:10px 4px;text-align:center;font-weight:700;color:#2d3748;font-size:10px;text-transform:uppercase;letter-spacing:0.5px;border-bottom:1px solid #cbd5e0}
.month-calendar-day{padding:10px 4px;text-align:center;border:1px solid #e2e8f0;cursor:pointer;transition:all 0.3s ease;position:relative;min-height:50px;display:flex;flex-direction:column;align-items:center;justify-content:center;background:#ffffff}
.month-calendar-day:hover{background:linear-gradient(135deg, #f7fafc 0%, #edf2f7 100%);transform:translateY(-1px);box-shadow:0 2px 8px rgba(0,0,0,0.06);border-color:#a0aec0}
.month-calendar-day.other-month{color:#a0aec0;background:#f8f9fa;opacity:0.5}
.month-calendar-day.today{background:linear-gradient(135deg, #ebf8ff 0%, #bee3f8 100%);border:2px solid #3182ce;font-weight:700;color:#1a365d;box-shadow:0 0 0 2px rgba(49,130,206,0.1)}
.month-calendar-day.win{background:transparent;color:#2d3748;border:1px solid #d1d5db;font-weight:600;box-shadow:none;position:relative;transform:none}
.month-calendar-day.win::after{content:'èƒœ';position:absolute;top:50%;right:4px;transform:translateY(-50%);font-size:10px;background:#16a34a;color:white;padding:1px 4px;border-radius:4px;font-weight:700}
.month-calendar-day.loss{background:transparent;color:#2d3748;border:1px solid #d1d5db;font-weight:600;box-shadow:none;position:relative;transform:none}
.month-calendar-day.loss::after{content:'è´Ÿ';position:absolute;top:50%;right:4px;transform:translateY(-50%);font-size:10px;background:#dc2626;color:white;padding:1px 4px;border-radius:4px;font-weight:700}
.month-calendar-day-number{font-size:13px;margin-bottom:2px;font-weight:600}
.month-calendar-day-status{font-size:9px;padding:2px 4px;border-radius:3px;background:rgba(45,55,72,0.1);color:#2d3748;font-weight:500;text-transform:uppercase;letter-spacing:0.2px}

/* å†å²æœˆä»½æ—¥å†æ ·å¼ */
.history-calendar{background:linear-gradient(135deg, #667eea 0%, #764ba2 100%);border-radius:8px;overflow:hidden;flex:1;box-shadow:0 4px 16px rgba(0,0,0,0.08);border:1px solid rgba(255,255,255,0.1)}
.history-calendar-header{background:linear-gradient(135deg, #2d3748 0%, #4a5568 100%);color:#f7fafc;padding:8px 12px;font-size:12px;font-weight:700;text-align:center;box-shadow:0 1px 4px rgba(0,0,0,0.1)}
.history-calendar-grid{display:grid;grid-template-columns:repeat(7,1fr);background:#ffffff}
.history-calendar-day-header{background:linear-gradient(135deg, #edf2f7 0%, #e2e8f0 100%);padding:4px 2px;text-align:center;font-weight:700;color:#2d3748;font-size:8px;text-transform:uppercase;letter-spacing:0.3px;border-bottom:1px solid #cbd5e0}
.history-calendar-day{padding:4px 2px;text-align:center;border:1px solid #e2e8f0;cursor:pointer;transition:all 0.2s ease;position:relative;min-height:28px;display:flex;flex-direction:column;align-items:center;justify-content:center;background:#ffffff;font-size:10px}
.history-calendar-day:hover{background:linear-gradient(135deg, #f7fafc 0%, #edf2f7 100%);transform:translateY(-1px);box-shadow:0 1px 4px rgba(0,0,0,0.06);border-color:#a0aec0}
.history-calendar-day.other-month{color:#a0aec0;background:#f8f9fa;opacity:0.4}
.history-calendar-day.today{background:linear-gradient(135deg, #ebf8ff 0%, #bee3f8 100%);border:1px solid #3182ce;font-weight:700;color:#1a365d;box-shadow:0 0 0 1px rgba(49,130,206,0.1)}
.history-calendar-day.win{background:transparent;color:#2d3748;border:1px solid #d1d5db;font-weight:600;box-shadow:none;position:relative;transform:none}
.history-calendar-day.win::after{content:'èƒœ';position:absolute;top:50%;right:2px;transform:translateY(-50%);font-size:7px;background:#16a34a;color:white;padding:1px 2px;border-radius:2px;font-weight:700}
.history-calendar-day.loss{background:transparent;color:#2d3748;border:1px solid #d1d5db;font-weight:600;box-shadow:none;position:relative;transform:none}
.history-calendar-day.loss::after{content:'è´Ÿ';position:absolute;top:50%;right:2px;transform:translateY(-50%);font-size:7px;background:#dc2626;color:white;padding:1px 2px;border-radius:2px;font-weight:700}
.history-calendar-day-number{font-size:10px;font-weight:600}

/* ç»Ÿè®¡è¡¨æ ¼æ ·å¼ */
.stats-row{display:flex;justify-content:space-between;align-items:center;padding:16px 20px;transition:all 0.3s ease;background:linear-gradient(135deg, rgba(255,255,255,0.95) 0%, rgba(248,250,252,0.95) 100%);margin-bottom:2px;border-radius:8px;box-shadow:0 2px 8px rgba(0,0,0,0.06)}
.stats-row:hover{background:linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%);transform:translateY(-2px) scale(1.01);box-shadow:0 4px 16px rgba(59,130,246,0.15)}
.stats-row:last-child{border-bottom:none}
.stats-row:first-child{border-radius:8px 8px 0 0}
.stats-row span:first-child{color:#475569;font-weight:600;font-size:14px;letter-spacing:0.3px}
.stats-row span:last-child{color:#1e293b;font-weight:800;font-size:16px;padding:4px 12px;border-radius:8px;min-width:60px;text-align:center}
.stats-row.correct span:last-child{background:#16a34a;color:white}
.stats-row.incorrect span:last-child{background:#dc2626;color:white}
.card{background:linear-gradient(135deg, #ffffff 0%, #f8fafc 100%);border-radius:12px;box-shadow:0 8px 32px rgba(0,0,0,0.08);border:1px solid rgba(255,255,255,0.1);overflow:hidden;margin-bottom:24px}
.card h4{background:linear-gradient(135deg, #2d3748 0%, #4a5568 100%);color:#f7fafc;margin:0;padding:20px;font-weight:800;font-size:18px;text-align:center;box-shadow:0 2px 8px rgba(0,0,0,0.1);border-radius:12px 12px 0 0}
.card .stats-container{padding:8px}

/* å“åº”å¼è®¾è®¡ */
@media(max-width:768px){
  .stats-grid{grid-template-columns:repeat(2,1fr)}
  .calendar-day{min-height:55px;padding:10px 4px}
  .calendar-day-number{font-size:13px}
  .calendar-header{padding:16px 18px}
  .calendar-nav{padding:6px 10px;font-size:14px}
  .tab-nav{flex-wrap:wrap}
  .tab-btn{flex:1;min-width:120px}
  .row{flex-direction:column}
  .history-calendar-day{min-height:24px;padding:2px 1px}
  .history-calendar-day-number{font-size:9px}
  .history-calendar-header{padding:6px 8px;font-size:11px}
  #historyCalendarsContainer{flex-direction:column;gap:8px}
  .history-calendar{margin-bottom:8px}
}

@media(max-width:480px){
  .stats-grid{grid-template-columns:1fr}
  .calendar-grid{font-size:11px}
  .calendar-day{min-height:45px;padding:8px 2px}
  .calendar-day-number{font-size:12px}
  .calendar-day-status{font-size:9px;padding:2px 4px}
  .calendar-header{padding:14px 16px}
  .calendar-nav{padding:5px 8px;font-size:13px}
  .history-calendar-day{min-height:20px;padding:2px 1px}
  .history-calendar-day-number{font-size:8px}
  .history-calendar-header{padding:4px 6px;font-size:10px}
  .source-btn{padding:6px 12px;font-size:12px}
  #historyMonthsRange{font-size:12px;min-width:150px}
}
</style>
</head>
<body>

<!-- å¯¼èˆªæ  -->
<div class="navbar">
  <div class="wrap">
    <div class="row" style="align-items:center;gap:12px">
      <h1>ğŸ“Š é¢„æµ‹æ¥æºè®°å½•éªŒè¯</h1>
      <div class="iconbar">
        <button class="icon-btn" title="å•åœºå½©" onclick="window.location.href='index.html'">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><path d="M12 6v6l4 2"/></svg>
        </button>
        <button class="icon-btn" title="å¤šé‡å½©" onclick="window.location.href='multi-bet.html'">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="3" width="18" height="18" rx="2" ry="2"/><path d="M9 9h6v6H9z"/><path d="M9 3v6"/><path d="M21 9h-6"/><path d="M15 21v-6"/><path d="M3 15h6"/></svg>
        </button>
        <button class="icon-btn active" title="é¢„æµ‹æ¥æºè®°å½•éªŒè¯">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M9 11H5a2 2 0 0 0-2 2v3a2 2 0 0 0 2 2h4"/><path d="M20 16V7a2 2 0 0 0-2-2H9a2 2 0 0 0-2 2v1"/><path d="M15 2v5"/><path d="M9 2v5"/><path d="M3 9h18"/><circle cx="16" cy="16" r="2"/><path d="m21 21-1.5-1.5"/></svg>
        </button>
        <button class="icon-btn" title="è®°äº‹æœ¬" onclick="window.location.href='notebook.html'">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14,2 14,8 20,8"/><line x1="16" y1="13" x2="8" y2="13"/><line x1="16" y1="17" x2="8" y2="17"/><polyline points="10,9 9,9 8,9"/></svg>
        </button>
        <button class="icon-btn" title="xG è¿½è¸ªåˆ†æ" onclick="window.location.href='xg-tracker.html'">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 3v18h18"/><path d="M7 12l3-3 3 3 5-5"/><circle cx="7" cy="12" r="1"/><circle cx="10" cy="9" r="1"/><circle cx="13" cy="12" r="1"/><circle cx="18" cy="7" r="1"/></svg>
        </button>
      </div>
    </div>
  </div>
</div>

<!-- ä¸»è¦å†…å®¹åŒºåŸŸ -->
<div class="wrap">
  <div class="card">
    <!-- æ ‡ç­¾é¡µå¯¼èˆª -->
    <div class="tab-nav">
      <button class="tab-btn" data-tab="sources">ğŸ“ é¢„æµ‹æ¥æºç®¡ç†</button>
      <button class="tab-btn active" data-tab="calendar">ğŸ“… æ—¥å†è®°å½•</button>
    </div>

    <!-- é¢„æµ‹æ¥æºç®¡ç†æ ‡ç­¾é¡µ -->
    <div class="tab-content" id="sources">
      <div class="row" style="gap:16px">
        <!-- å·¦ä¾§ï¼šæ·»åŠ æ–°æ¥æº -->
        <div class="col" style="flex:1">
          <div class="card">
            <h3 style="margin:0 0 16px;color:#334155">â• æ·»åŠ æ–°é¢„æµ‹æ¥æº</h3>
            <div class="field" style="margin-bottom:12px">
              <label>æ¥æºåç§° <span style="color:#ef4444">*</span></label>
              <input id="sourceName" placeholder="å¦‚ï¼šä¸“å®¶Aã€ç½‘ç«™Bã€è‡ªå·±åˆ†æç­‰">
            </div>
            <div class="field" style="margin-bottom:12px">
              <label>æ¥æºè¯„çº§ <span style="color:#ef4444">*</span></label>
              <select id="sourceRating">
                <option value="">è¯·é€‰æ‹©è¯„çº§</option>
                <option value="1">â­ 1æ˜Ÿ - ä¸€èˆ¬</option>
                <option value="2">â­â­ 2æ˜Ÿ - è¾ƒå¥½</option>
                <option value="3">â­â­â­ 3æ˜Ÿ - è‰¯å¥½</option>
                <option value="4">â­â­â­â­ 4æ˜Ÿ - ä¼˜ç§€</option>
                <option value="5">â­â­â­â­â­ 5æ˜Ÿ - å“è¶Š</option>
              </select>
            </div>
            <div class="field" style="margin-bottom:16px">
              <label>è¯¦ç»†è¯´æ˜</label>
              <textarea id="sourceDescription" rows="4" placeholder="æè¿°è¯¥é¢„æµ‹æ¥æºçš„ç‰¹ç‚¹ã€å‡†ç¡®ç‡ã€åˆ†ææ–¹æ³•ç­‰è¯¦ç»†ä¿¡æ¯..."></textarea>
            </div>
            <div class="row">
              <button id="addSourceBtn" class="btn">ä¿å­˜æ¥æº</button>
              <button id="clearSourceForm" class="btn sec">æ¸…ç©º</button>
            </div>
            <div class="row" style="margin-top:12px">
              <button id="exportDataBtn" class="btn" style="background:linear-gradient(135deg, #10b981 0%, #059669 100%);color:white;box-shadow:0 4px 12px rgba(16,185,129,0.3);border:none">å¯¼å‡ºæ•°æ®</button>
              <button id="importDataBtn" class="btn" style="background:linear-gradient(135deg, #f59e0b 0%, #d97706 100%);color:white;box-shadow:0 4px 12px rgba(245,158,11,0.3);border:none">å¯¼å…¥æ•°æ®</button>
              <input type="file" id="importFileInput" accept=".json" style="display:none">
            </div>
          </div>
        </div>
        
        <!-- å³ä¾§ï¼šç°æœ‰æ¥æºåˆ—è¡¨ -->
        <div class="col" style="flex:2">
          <div class="card">
            <h3 style="margin:0 0 16px;color:#334155">ğŸ“‹ ç°æœ‰é¢„æµ‹æ¥æº</h3>
            <div id="sourcesList">
              <!-- æ¥æºåˆ—è¡¨å°†åœ¨è¿™é‡ŒåŠ¨æ€ç”Ÿæˆ -->
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- æ—¥å†è®°å½•æ ‡ç­¾é¡µ -->
    <div class="tab-content active" id="calendar">
      <!-- é¢„æµ‹æ¥æºæŒ‰é’®ç»„ -->
      <div style="margin-bottom:16px">
        <label style="display:block;margin-bottom:8px;font-weight:600;color:#374151">é€‰æ‹©é¢„æµ‹æ¥æº</label>
        <div id="sourceButtons" style="display:flex;flex-wrap:wrap;gap:8px;margin-bottom:16px">
          <!-- æ¥æºæŒ‰é’®å°†åœ¨è¿™é‡ŒåŠ¨æ€ç”Ÿæˆ -->
        </div>

      </div>
      
      <!-- ä¸»è¦å†…å®¹åŒºåŸŸï¼šä¸Šæ–¹å½“å‰æœˆå†ï¼Œä¸‹æ–¹å†å²æœˆå†ï¼Œå³è¾¹ç»Ÿè®¡ -->
      <div class="row" style="gap:20px;align-items:flex-start">
        <!-- å·¦ä¾§ï¼šæ—¥å†åŒºåŸŸ -->
        <div class="col" style="flex:2">
          <!-- å½“å‰æœˆä»½æ—¥å† -->
          <div id="currentMonthCalendar" style="margin-bottom:20px">
            <!-- å½“å‰æœˆä»½çš„å®Œæ•´æ—¥å†å°†åœ¨è¿™é‡Œç”Ÿæˆ -->
          </div>
          
          <!-- å†å²æœˆä»½å¯¼èˆªå’Œæ—¥å† -->
          <div style="background:linear-gradient(135deg, #ffffff 0%, #f8fafc 100%);border-radius:12px;padding:16px;box-shadow:0 8px 32px rgba(0,0,0,0.08);border:1px solid rgba(255,255,255,0.1)">
            <!-- å¯¼èˆªæ§ä»¶ -->
            <div style="display:flex;align-items:center;justify-content:center;margin-bottom:16px;gap:20px">
              <button id="prevMonthsBtn" class="calendar-nav" style="background:rgba(59,130,246,0.1);border:1px solid rgba(59,130,246,0.2);color:#3b82f6">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="15,18 9,12 15,6"></polyline></svg>
              </button>
              <span id="historyMonthsRange" style="font-weight:600;color:#374151;min-width:200px;text-align:center"></span>
              <button id="nextMonthsBtn" class="calendar-nav" style="background:rgba(59,130,246,0.1);border:1px solid rgba(59,130,246,0.2);color:#3b82f6">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="9,18 15,12 9,6"></polyline></svg>
              </button>
            </div>
            
            <!-- å†å²ä¸‰ä¸ªæœˆçš„æ—¥å† -->
            <div id="historyCalendarsContainer" style="display:flex;gap:12px">
              <!-- å†å²ä¸‰ä¸ªæœˆçš„æ—¥å†å°†åœ¨è¿™é‡Œç”Ÿæˆ -->
            </div>
          </div>
        </div>
        
        <!-- å³ä¾§ï¼šç»Ÿè®¡è¡¨æ ¼ -->
        <div class="col" style="flex:1">
          <!-- æ‰€æœ‰æ—¶é—´ç»Ÿè®¡ -->
          <div style="margin-bottom:16px">
            <h4 style="background:linear-gradient(135deg, #2d3748 0%, #4a5568 100%);color:#f7fafc;margin:0;padding:20px;font-weight:800;font-size:18px;text-align:center;box-shadow:0 2px 8px rgba(0,0,0,0.1);border-radius:12px 12px 0 0">ğŸ“Š æ‰€æœ‰æ—¶é—´ç»Ÿè®¡</h4>
            <div class="stats-container" style="background:linear-gradient(135deg, #ffffff 0%, #f8fafc 100%);border-radius:0 0 12px 12px;box-shadow:0 8px 32px rgba(0,0,0,0.08);border:1px solid rgba(255,255,255,0.1);border-top:none;padding:8px">
              <div class="stats-row">
                <span>æ€»é¢„æµ‹å¤©æ•°</span>
                <span id="allTotalDays">0</span>
              </div>
              <div class="stats-row correct">
                <span>é¢„æµ‹æ­£ç¡®</span>
                <span id="allWinDays">0</span>
              </div>
              <div class="stats-row incorrect">
                <span>é¢„æµ‹é”™è¯¯</span>
                <span id="allLossDays">0</span>
              </div>
              <div class="stats-row">
                <span>å‡†ç¡®ç‡</span>
                <span id="allWinRate">0%</span>
              </div>
              <div class="stats-row">
                <span>å½“å‰è¿ç»­</span>
                <span id="allCurrentStreak">0</span>
              </div>
            </div>
          </div>
          
          <!-- å½“æœˆç»Ÿè®¡ -->
          <div>
            <h4 style="background:linear-gradient(135deg, #2d3748 0%, #4a5568 100%);color:#f7fafc;margin:0;padding:20px;font-weight:800;font-size:18px;text-align:center;box-shadow:0 2px 8px rgba(0,0,0,0.1);border-radius:12px 12px 0 0">ğŸ“… å½“æœˆç»Ÿè®¡</h4>
            <div class="stats-container" style="background:linear-gradient(135deg, #ffffff 0%, #f8fafc 100%);border-radius:0 0 12px 12px;box-shadow:0 8px 32px rgba(0,0,0,0.08);border:1px solid rgba(255,255,255,0.1);border-top:none;padding:8px">
              <div class="stats-row">
                <span>æœ¬æœˆé¢„æµ‹å¤©æ•°</span>
                <span id="monthTotalDays">0</span>
              </div>
              <div class="stats-row correct">
                <span>é¢„æµ‹æ­£ç¡®</span>
                <span id="monthWinDays">0</span>
              </div>
              <div class="stats-row incorrect">
                <span>é¢„æµ‹é”™è¯¯</span>
                <span id="monthLossDays">0</span>
              </div>
              <div class="stats-row">
                <span>å‡†ç¡®ç‡</span>
                <span id="monthWinRate">0%</span>
              </div>
              <div class="stats-row">
                <span>æœ¬æœˆè¿ç»­</span>
                <span id="monthCurrentStreak">0</span>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>


  </div>
</div>

<script>
// å…¨å±€å˜é‡
let predictionSources = JSON.parse(localStorage.getItem('predictionSources') || '[]');
let predictionRecords = JSON.parse(localStorage.getItem('predictionRecords') || '{}');
let currentDate = new Date();
let selectedSource = null;
let historyMonthOffset = 0; // å†å²æœˆä»½åç§»é‡ï¼Œ0è¡¨ç¤ºæ˜¾ç¤ºå½“å‰æœˆå‰3ä¸ªæœˆ

// å·¥å…·å‡½æ•°
function $(selector) {
  return document.querySelector(selector);
}

function $$(selector) {
  return document.querySelectorAll(selector);
}

function formatDate(date) {
  return date.getFullYear() + '-' + 
         String(date.getMonth() + 1).padStart(2, '0') + '-' + 
         String(date.getDate()).padStart(2, '0');
}

function saveData() {
  localStorage.setItem('predictionSources', JSON.stringify(predictionSources));
  localStorage.setItem('predictionRecords', JSON.stringify(predictionRecords));
}

// æ ‡ç­¾é¡µåˆ‡æ¢
function initTabs() {
  $$('.tab-btn').forEach(btn => {
    btn.addEventListener('click', () => {
      const tabId = btn.dataset.tab;
      
      // æ›´æ–°æŒ‰é’®çŠ¶æ€
      $$('.tab-btn').forEach(b => b.classList.remove('active'));
      btn.classList.add('active');
      
      // æ›´æ–°å†…å®¹æ˜¾ç¤º
      $$('.tab-content').forEach(content => {
        content.classList.remove('active');
      });
      $('#' + tabId).classList.add('active');
      
      // æ ¹æ®æ ‡ç­¾é¡µæ‰§è¡Œç›¸åº”çš„åˆå§‹åŒ–
      if (tabId === 'sources') {
        renderSourcesList();
      } else if (tabId === 'calendar') {
        updateSourceSelects();
        renderMultipleCalendars();
        updateCalendarStatistics();
      }
    });
  });
}

// é¢„æµ‹æ¥æºç®¡ç†
function initSourcesManagement() {
  $('#addSourceBtn').addEventListener('click', addSource);
  $('#clearSourceForm').addEventListener('click', clearSourceForm);
  
  // å¯¼å‡ºæ•°æ®
  $('#exportDataBtn').addEventListener('click', exportData);
  
  // å¯¼å…¥æ•°æ®
  $('#importDataBtn').addEventListener('click', () => {
    $('#importFileInput').click();
  });
  
  $('#importFileInput').addEventListener('change', importData);
  
  renderSourcesList();
}

function addSource() {
  const name = $('#sourceName').value.trim();
  const rating = $('#sourceRating').value;
  const description = $('#sourceDescription').value.trim();
  
  if (!name) {
    alert('è¯·è¾“å…¥æ¥æºåç§°');
    return;
  }
  
  if (!rating) {
    alert('è¯·é€‰æ‹©æ¥æºè¯„çº§');
    return;
  }
  
  // æ£€æŸ¥æ˜¯å¦å·²å­˜åœ¨åŒåæ¥æº
  if (predictionSources.some(source => source.name === name)) {
    alert('è¯¥æ¥æºåç§°å·²å­˜åœ¨ï¼Œè¯·ä½¿ç”¨å…¶ä»–åç§°');
    return;
  }
  
  const newSource = {
    id: Date.now(),
    name: name,
    rating: parseInt(rating),
    description: description,
    createdAt: new Date().toISOString()
  };
  
  predictionSources.push(newSource);
  saveData();
  renderSourcesList();
  updateSourceSelects();
  clearSourceForm();
  
  alert('é¢„æµ‹æ¥æºæ·»åŠ æˆåŠŸï¼');
}

function clearSourceForm() {
  $('#sourceName').value = '';
  $('#sourceRating').value = '';
  $('#sourceDescription').value = '';
}

function renderSourcesList() {
  const container = $('#sourcesList');
  
  if (predictionSources.length === 0) {
    container.innerHTML = '<div style="text-align:center;padding:40px;color:#64748b">æš‚æ— é¢„æµ‹æ¥æº<br><small>è¯·å…ˆæ·»åŠ é¢„æµ‹æ¥æº</small></div>';
    return;
  }
  
  container.innerHTML = predictionSources.map(source => {
    const ratingStars = 'â­'.repeat(source.rating || 1);
    const ratingText = ['', 'ä¸€èˆ¬', 'è¾ƒå¥½', 'è‰¯å¥½', 'ä¼˜ç§€', 'å“è¶Š'][source.rating || 1];
    
    return `
    <div class="source-item">
      <div class="source-header">
        <div class="source-name">
          ${source.name}
          <span style="margin-left:8px;color:#6b7280;font-size:12px">${ratingStars} ${ratingText}</span>
        </div>
        <div class="source-actions">
          <button class="btn-small" onclick="editSource(${source.id})">ç¼–è¾‘</button>
          <button class="btn-small warn" onclick="deleteSource(${source.id})">åˆ é™¤</button>
        </div>
      </div>
      ${source.description ? `<div class="source-description">${source.description}</div>` : ''}
      <div class="small muted" style="margin-top:8px">åˆ›å»ºæ—¶é—´ï¼š${new Date(source.createdAt).toLocaleString()}</div>
    </div>
    `;
  }).join('');
}

function editSource(id) {
  const source = predictionSources.find(s => s.id === id);
  if (!source) return;
  
  const newName = prompt('è¯·è¾“å…¥æ–°çš„æ¥æºåç§°ï¼š', source.name);
  if (newName === null) return;
  
  if (!newName.trim()) {
    alert('æ¥æºåç§°ä¸èƒ½ä¸ºç©º');
    return;
  }
  
  // æ£€æŸ¥æ˜¯å¦ä¸å…¶ä»–æ¥æºé‡å
  if (predictionSources.some(s => s.id !== id && s.name === newName.trim())) {
    alert('è¯¥æ¥æºåç§°å·²å­˜åœ¨ï¼Œè¯·ä½¿ç”¨å…¶ä»–åç§°');
    return;
  }
  
  const ratingOptions = ['1æ˜Ÿ - ä¸€èˆ¬', '2æ˜Ÿ - è¾ƒå¥½', '3æ˜Ÿ - è‰¯å¥½', '4æ˜Ÿ - ä¼˜ç§€', '5æ˜Ÿ - å“è¶Š'];
  const currentRatingText = ratingOptions[source.rating - 1] || '1æ˜Ÿ - ä¸€èˆ¬';
  const newRatingText = prompt(`è¯·é€‰æ‹©æ–°çš„è¯„çº§ï¼ˆè¾“å…¥1-5ï¼‰ï¼š\n1 - ä¸€èˆ¬\n2 - è¾ƒå¥½\n3 - è‰¯å¥½\n4 - ä¼˜ç§€\n5 - å“è¶Š\n\nå½“å‰è¯„çº§ï¼š${currentRatingText}`, source.rating || 1);
  if (newRatingText === null) return;
  
  const newRating = parseInt(newRatingText);
  if (isNaN(newRating) || newRating < 1 || newRating > 5) {
    alert('è¯„çº§å¿…é¡»æ˜¯1-5ä¹‹é—´çš„æ•°å­—');
    return;
  }
  
  const newDescription = prompt('è¯·è¾“å…¥æ–°çš„è¯¦ç»†è¯´æ˜ï¼š', source.description || '');
  if (newDescription === null) return;
  
  source.name = newName.trim();
  source.rating = newRating;
  source.description = newDescription.trim();
  
  saveData();
  renderSourcesList();
  updateSourceSelects();
  
  alert('é¢„æµ‹æ¥æºæ›´æ–°æˆåŠŸï¼');
}

function deleteSource(id) {
  const source = predictionSources.find(s => s.id === id);
  if (!source) return;
  
  if (!confirm(`ç¡®å®šè¦åˆ é™¤é¢„æµ‹æ¥æº"${source.name}"å—ï¼Ÿ\n\næ³¨æ„ï¼šåˆ é™¤åè¯¥æ¥æºçš„æ‰€æœ‰é¢„æµ‹è®°å½•ä¹Ÿå°†è¢«åˆ é™¤ï¼Œæ­¤æ“ä½œä¸å¯æ¢å¤ï¼`)) {
    return;
  }
  
  // åˆ é™¤æ¥æº
  predictionSources = predictionSources.filter(s => s.id !== id);
  
  // åˆ é™¤ç›¸å…³çš„é¢„æµ‹è®°å½•
  Object.keys(predictionRecords).forEach(date => {
    if (predictionRecords[date][id]) {
      delete predictionRecords[date][id];
      if (Object.keys(predictionRecords[date]).length === 0) {
        delete predictionRecords[date];
      }
    }
  });
  
  saveData();
  renderSourcesList();
  updateSourceSelects();
  renderCalendar();
  updateStatistics();
  
  alert('é¢„æµ‹æ¥æºåˆ é™¤æˆåŠŸï¼');
}

// æ›´æ–°æ¥æºé€‰æ‹©ä¸‹æ‹‰æ¡†å’ŒæŒ‰é’®
function updateSourceSelects() {
  // æ›´æ–°ç»Ÿè®¡é¡µé¢çš„ä¸‹æ‹‰æ¡†
  const statsSelect = $('#statsSourceSelect');
  if (statsSelect) {
    const currentValue = statsSelect.value;
    statsSelect.innerHTML = '<option value="">è¯·é€‰æ‹©é¢„æµ‹æ¥æº</option>' + 
      predictionSources.map(source => 
        `<option value="${source.id}">${source.name}</option>`
      ).join('');
    
    // æ¢å¤ä¹‹å‰çš„é€‰æ‹©
    if (currentValue && predictionSources.some(s => s.id == currentValue)) {
      statsSelect.value = currentValue;
    }
  }
  
  // æ›´æ–°æ—¥å†é¡µé¢çš„æ¥æºæŒ‰é’®
  updateSourceButtons();
}

// æ›´æ–°æ¥æºæŒ‰é’®
function updateSourceButtons() {
  const container = $('#sourceButtons');
  if (!container) return;
  
  if (predictionSources.length === 0) {
    container.innerHTML = '<div style="color:#64748b;font-style:italic">æš‚æ— é¢„æµ‹æ¥æºï¼Œè¯·å…ˆæ·»åŠ é¢„æµ‹æ¥æº</div>';
    return;
  }
  
  container.innerHTML = predictionSources.map(source => 
    `<button class="source-btn rating-${source.rating || 1}" data-source-id="${source.id}">${source.name}</button>`
  ).join('');
  
  // æ·»åŠ ç‚¹å‡»äº‹ä»¶
  container.querySelectorAll('.source-btn').forEach(btn => {
    btn.addEventListener('click', () => {
      // ç§»é™¤å…¶ä»–æŒ‰é’®çš„activeçŠ¶æ€
      container.querySelectorAll('.source-btn').forEach(b => b.classList.remove('active'));
      // æ·»åŠ å½“å‰æŒ‰é’®çš„activeçŠ¶æ€
      btn.classList.add('active');
      // è®¾ç½®é€‰ä¸­çš„æ¥æº
      selectedSource = parseInt(btn.dataset.sourceId);
      // é‡æ–°æ¸²æŸ“æ—¥å†å’Œç»Ÿè®¡
      renderMultipleCalendars();
      updateCalendarStatistics();
    });
  });
}

// æ—¥å†åŠŸèƒ½
function initCalendar() {
  renderCurrentMonthCalendar();
  renderHistoryCalendars();
  initHistoryNavigation();
}

// åˆå§‹åŒ–å†å²æœˆä»½å¯¼èˆª
function initHistoryNavigation() {
  $('#prevMonthsBtn').addEventListener('click', () => {
    historyMonthOffset--;
    renderHistoryCalendars();
    updateHistoryMonthsRange();
  });
  
  $('#nextMonthsBtn').addEventListener('click', () => {
    historyMonthOffset++;
    renderHistoryCalendars();
    updateHistoryMonthsRange();
  });
  
  updateHistoryMonthsRange();
}

// æ›´æ–°å†å²æœˆä»½èŒƒå›´æ˜¾ç¤º
function updateHistoryMonthsRange() {
  const today = new Date();
  const baseMonth = new Date(today.getFullYear(), today.getMonth() + historyMonthOffset - 2, 1);
  const months = [];
  
  for (let i = 0; i < 3; i++) {
    const monthDate = new Date(baseMonth);
    monthDate.setMonth(baseMonth.getMonth() + i);
    months.push(`${monthDate.getFullYear()}å¹´${monthDate.getMonth() + 1}æœˆ`);
  }
  
  $('#historyMonthsRange').textContent = months.join(' â€¢ ');
}

// æ¸²æŸ“å½“å‰æœˆä»½æ—¥å†
function renderCurrentMonthCalendar() {
  const container = $('#currentMonthCalendar');
  if (!container) return;
  
  const today = new Date();
  const currentMonth = new Date(today.getFullYear(), today.getMonth(), 1);
  
  container.innerHTML = renderSingleCalendar(currentMonth, 'current');
  
  // ä¸ºå½“å‰æœˆæ—¥å†æ·»åŠ ç‚¹å‡»äº‹ä»¶
  container.querySelectorAll('.calendar-day').forEach(dayElement => {
    dayElement.addEventListener('click', () => {
      if (!selectedSource) {
        alert('è¯·å…ˆé€‰æ‹©é¢„æµ‹æ¥æº');
        return;
      }
      
      const dateStr = dayElement.dataset.date;
      if (!dateStr) return;
      
      const currentResult = predictionRecords[dateStr] && predictionRecords[dateStr][selectedSource];
      let newResult;
      
      if (!currentResult) {
        newResult = 'win';
      } else if (currentResult === 'win') {
        newResult = 'loss';
      } else {
        newResult = null; // æ¸…é™¤è®°å½•
      }
      
      setDayResult(dateStr, selectedSource, newResult);
      renderCurrentMonthCalendar();
      renderHistoryCalendars();
      updateCalendarStatistics();
    });
  });
}

// æ¸²æŸ“å†å²ä¸‰ä¸ªæœˆçš„æ—¥å†
function renderHistoryCalendars() {
  const container = $('#historyCalendarsContainer');
  if (!container) return;
  
  const today = new Date();
  const baseMonth = new Date(today.getFullYear(), today.getMonth() + historyMonthOffset - 2, 1);
  
  // ç”Ÿæˆä¸‰ä¸ªå†å²æœˆä»½
  const months = [];
  for (let i = 0; i < 3; i++) {
    const monthDate = new Date(baseMonth);
    monthDate.setMonth(baseMonth.getMonth() + i);
    months.push(monthDate);
  }
  
  container.innerHTML = months.map(monthDate => {
    return renderHistoryCalendar(monthDate);
  }).join('');
  
  // ä¸ºå†å²æ—¥å†æ·»åŠ ç‚¹å‡»äº‹ä»¶
  container.querySelectorAll('.history-calendar-day').forEach(dayElement => {
    dayElement.addEventListener('click', () => {
      if (!selectedSource) {
        alert('è¯·å…ˆé€‰æ‹©é¢„æµ‹æ¥æº');
        return;
      }
      
      const dateStr = dayElement.dataset.date;
      if (!dateStr) return;
      
      const currentResult = predictionRecords[dateStr] && predictionRecords[dateStr][selectedSource];
      let newResult;
      
      if (!currentResult) {
        newResult = 'win';
      } else if (currentResult === 'win') {
        newResult = 'loss';
      } else {
        newResult = null; // æ¸…é™¤è®°å½•
      }
      
      setDayResult(dateStr, selectedSource, newResult);
      renderCurrentMonthCalendar();
      renderHistoryCalendars();
      updateCalendarStatistics();
    });
  });
}

// å…¼å®¹æ—§å‡½æ•°å
function renderMultipleCalendars() {
  renderCurrentMonthCalendar();
  renderHistoryCalendars();
}

// æ¸²æŸ“å•ä¸ªæœˆçš„æ—¥å†ï¼ˆå½“å‰æœˆä»½ç”¨ï¼‰
function renderSingleCalendar(monthDate, type = 'current') {
  const year = monthDate.getFullYear();
  const month = monthDate.getMonth();
  
  // è·å–æœˆä»½ä¿¡æ¯
  const firstDay = new Date(year, month, 1);
  const lastDay = new Date(year, month + 1, 0);
  const startDate = new Date(firstDay);
  startDate.setDate(startDate.getDate() - firstDay.getDay());
  
  // æ˜ŸæœŸæ ‡é¢˜
  const weekdays = ['æ—¥', 'ä¸€', 'äºŒ', 'ä¸‰', 'å››', 'äº”', 'å…­'];
  const weekdayHeaders = weekdays.map(day => 
    `<div class="calendar-day-header">${day}</div>`
  ).join('');
  
  // ç”Ÿæˆæ—¥æœŸ
  const today = new Date();
  const todayStr = formatDate(today);
  let daysHtml = '';
  
  for (let i = 0; i < 42; i++) {
    const date = new Date(startDate);
    date.setDate(startDate.getDate() + i);
    const dateStr = formatDate(date);
    
    let dayClasses = ['calendar-day'];
    
    // æ·»åŠ æ ·å¼ç±»
    if (date.getMonth() !== month) {
      dayClasses.push('other-month');
    }
    if (dateStr === todayStr) {
      dayClasses.push('today');
    }
    
    // è·å–è¯¥æ—¥æœŸçš„é¢„æµ‹ç»“æœ
    let dayResult = null;
    if (selectedSource && predictionRecords[dateStr] && predictionRecords[dateStr][selectedSource]) {
      dayResult = predictionRecords[dateStr][selectedSource];
      dayClasses.push(dayResult);
    }
    
    // ç”Ÿæˆæ—¥æœŸHTML
    daysHtml += `
      <div class="${dayClasses.join(' ')}" data-date="${dateStr}">
        <div class="calendar-day-number">${date.getDate()}</div>
      </div>
    `;
  }
  
  return `
    <div class="calendar">
      <div class="calendar-header">
        <span>${year}å¹´${month + 1}æœˆ</span>
      </div>
      <div class="calendar-grid">
        ${weekdayHeaders}
        ${daysHtml}
      </div>
    </div>
  `;
}

// æ¸²æŸ“å†å²æœˆä»½çš„å°æ—¥å†
function renderHistoryCalendar(monthDate) {
  const year = monthDate.getFullYear();
  const month = monthDate.getMonth();
  
  // è·å–æœˆä»½ä¿¡æ¯
  const firstDay = new Date(year, month, 1);
  const lastDay = new Date(year, month + 1, 0);
  const startDate = new Date(firstDay);
  startDate.setDate(startDate.getDate() - firstDay.getDay());
  
  // æ˜ŸæœŸæ ‡é¢˜
  const weekdays = ['æ—¥', 'ä¸€', 'äºŒ', 'ä¸‰', 'å››', 'äº”', 'å…­'];
  const weekdayHeaders = weekdays.map(day => 
    `<div class="history-calendar-day-header">${day}</div>`
  ).join('');
  
  // ç”Ÿæˆæ—¥æœŸ
  const today = new Date();
  const todayStr = formatDate(today);
  let daysHtml = '';
  
  for (let i = 0; i < 42; i++) {
    const date = new Date(startDate);
    date.setDate(startDate.getDate() + i);
    const dateStr = formatDate(date);
    
    let dayClasses = ['history-calendar-day'];
    
    // æ·»åŠ æ ·å¼ç±»
    if (date.getMonth() !== month) {
      dayClasses.push('other-month');
    }
    if (dateStr === todayStr) {
      dayClasses.push('today');
    }
    
    // è·å–è¯¥æ—¥æœŸçš„é¢„æµ‹ç»“æœ
    let dayResult = null;
    if (selectedSource && predictionRecords[dateStr] && predictionRecords[dateStr][selectedSource]) {
      dayResult = predictionRecords[dateStr][selectedSource];
      dayClasses.push(dayResult);
    }
    
    // ç”Ÿæˆæ—¥æœŸHTML
    daysHtml += `
      <div class="${dayClasses.join(' ')}" data-date="${dateStr}">
        <div class="history-calendar-day-number">${date.getDate()}</div>
      </div>
    `;
  }
  
  return `
    <div class="history-calendar">
      <div class="history-calendar-header">${year}å¹´${month + 1}æœˆ</div>
      <div class="history-calendar-grid">
        ${weekdayHeaders}
        ${daysHtml}
      </div>
    </div>
  `;
}

// æ›´æ–°æ—¥å†é¡µé¢çš„ç»Ÿè®¡ä¿¡æ¯
function updateCalendarStatistics() {
  if (!selectedSource) {
    // æ¸…ç©ºç»Ÿè®¡æ˜¾ç¤º
    $('#allTotalDays').textContent = '0';
    $('#allWinDays').textContent = '0';
    $('#allLossDays').textContent = '0';
    $('#allWinRate').textContent = '0%';
    $('#allCurrentStreak').textContent = '0';
    
    $('#monthTotalDays').textContent = '0';
    $('#monthWinDays').textContent = '0';
    $('#monthLossDays').textContent = '0';
    $('#monthWinRate').textContent = '0%';
    $('#monthCurrentStreak').textContent = '0';
    return;
  }
  
  // è·å–æ‰€æœ‰æ—¶é—´çš„è®°å½•
  const allRecords = [];
  Object.keys(predictionRecords).forEach(dateStr => {
    if (predictionRecords[dateStr][selectedSource]) {
      allRecords.push({
        date: dateStr,
        result: predictionRecords[dateStr][selectedSource]
      });
    }
  });
  
  // æŒ‰æ—¥æœŸæ’åº
  allRecords.sort((a, b) => a.date.localeCompare(b.date));
  
  // è®¡ç®—æ‰€æœ‰æ—¶é—´ç»Ÿè®¡
  const allTotalDays = allRecords.length;
  const allWinDays = allRecords.filter(r => r.result === 'win').length;
  const allLossDays = allRecords.filter(r => r.result === 'loss').length;
  const allWinRate = allTotalDays > 0 ? Math.round((allWinDays / allTotalDays) * 100) : 0;
  
  // è®¡ç®—å½“å‰è¿ç»­
  let allCurrentStreak = 0;
  let allCurrentStreakType = '';
  if (allRecords.length > 0) {
    const lastResult = allRecords[allRecords.length - 1].result;
    allCurrentStreakType = lastResult;
    for (let i = allRecords.length - 1; i >= 0; i--) {
      if (allRecords[i].result === lastResult) {
        allCurrentStreak++;
      } else {
        break;
      }
    }
  }
  
  // è·å–å½“æœˆè®°å½•
  const currentDate = new Date();
  const currentYear = currentDate.getFullYear();
  const currentMonth = currentDate.getMonth();
  const monthRecords = allRecords.filter(record => {
    const recordDate = new Date(record.date);
    return recordDate.getFullYear() === currentYear && recordDate.getMonth() === currentMonth;
  });
  
  // è®¡ç®—å½“æœˆç»Ÿè®¡
  const monthTotalDays = monthRecords.length;
  const monthWinDays = monthRecords.filter(r => r.result === 'win').length;
  const monthLossDays = monthRecords.filter(r => r.result === 'loss').length;
  const monthWinRate = monthTotalDays > 0 ? Math.round((monthWinDays / monthTotalDays) * 100) : 0;
  
  // è®¡ç®—å½“æœˆè¿ç»­
  let monthCurrentStreak = 0;
  let monthCurrentStreakType = '';
  if (monthRecords.length > 0) {
    const lastResult = monthRecords[monthRecords.length - 1].result;
    monthCurrentStreakType = lastResult;
    for (let i = monthRecords.length - 1; i >= 0; i--) {
      if (monthRecords[i].result === lastResult) {
        monthCurrentStreak++;
      } else {
        break;
      }
    }
  }
  
  // æ›´æ–°æ˜¾ç¤º
  $('#allTotalDays').textContent = allTotalDays;
  $('#allWinDays').textContent = allWinDays;
  $('#allLossDays').textContent = allLossDays;
  $('#allWinRate').textContent = allWinRate + '%';
  $('#allCurrentStreak').textContent = allCurrentStreak > 0 ? 
    allCurrentStreak + (allCurrentStreakType === 'win' ? 'è¿èƒœ' : 'è¿è´¥') : '0';
  
  $('#monthTotalDays').textContent = monthTotalDays;
  $('#monthWinDays').textContent = monthWinDays;
  $('#monthLossDays').textContent = monthLossDays;
  $('#monthWinRate').textContent = monthWinRate + '%';
  $('#monthCurrentStreak').textContent = monthCurrentStreak > 0 ? 
    monthCurrentStreak + (monthCurrentStreakType === 'win' ? 'è¿èƒœ' : 'è¿è´¥') : '0';
}

function setDayResult(dateStr, sourceId, result) {
  if (!predictionRecords[dateStr]) {
    predictionRecords[dateStr] = {};
  }
  
  if (result === null) {
    delete predictionRecords[dateStr][sourceId];
    if (Object.keys(predictionRecords[dateStr]).length === 0) {
      delete predictionRecords[dateStr];
    }
  } else {
    predictionRecords[dateStr][sourceId] = result;
  }
  
  saveData();
}



// å¯¼å‡ºæ•°æ®åŠŸèƒ½
function exportData() {
  const data = {
    predictionSources: predictionSources,
    predictionRecords: predictionRecords,
    exportTime: new Date().toISOString()
  };
  
  const dataStr = JSON.stringify(data, null, 2);
  const dataBlob = new Blob([dataStr], {type: 'application/json'});
  
  const link = document.createElement('a');
  link.href = URL.createObjectURL(dataBlob);
  link.download = `prediction-data-${new Date().toISOString().split('T')[0]}.json`;
  link.click();
  
  alert('æ•°æ®å¯¼å‡ºæˆåŠŸï¼');
}

// å¯¼å…¥æ•°æ®åŠŸèƒ½
function importData(event) {
  const file = event.target.files[0];
  if (!file) return;
  
  const reader = new FileReader();
  reader.onload = function(e) {
    try {
      const data = JSON.parse(e.target.result);
      
      if (!data.predictionSources || !data.predictionRecords) {
        alert('å¯¼å…¥æ–‡ä»¶æ ¼å¼ä¸æ­£ç¡®ï¼');
        return;
      }
      
      
      
      predictionSources = data.predictionSources;
      predictionRecords = data.predictionRecords;
      
      saveData();
      renderSourcesList();
      updateSourceSelects();
      renderMultipleCalendars();
      updateCalendarStatistics();
      
      alert('æ•°æ®å¯¼å…¥æˆåŠŸï¼');
    } catch (error) {
      alert('å¯¼å…¥æ–‡ä»¶æ ¼å¼é”™è¯¯ï¼š' + error.message);
    }
  };
  
  reader.readAsText(file);
  
  // æ¸…ç©ºæ–‡ä»¶è¾“å…¥
  event.target.value = '';
}

// æ•°æ®è¿ç§»ï¼šä¸ºæ—§æ•°æ®æ·»åŠ é»˜è®¤è¯„çº§
function migrateData() {
  let needsSave = false;
  predictionSources.forEach(source => {
    if (!source.rating) {
      source.rating = 3; // é»˜è®¤3æ˜Ÿè¯„çº§
      needsSave = true;
    }
  });
  
  if (needsSave) {
    saveData();
  }
}

// åˆå§‹åŒ–
document.addEventListener('DOMContentLoaded', function() {
  migrateData();
  initTabs();
  initSourcesManagement();
  initCalendar();

  updateSourceSelects();
});
</script>

</body>
</html>