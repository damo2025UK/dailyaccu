<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>⚽ 预测来源记录验证</title>
<style>
/* 基础样式 */
*{box-sizing:border-box}
body{margin:0;font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,sans-serif;background:#f8fafc;color:#334155;line-height:1.5}
.wrap{width:100%;margin:0;padding:12px}
.row{display:flex;gap:8px;align-items:stretch}
.col{display:flex;flex-direction:column;gap:8px}
.card{background:white;border-radius:8px;padding:16px;box-shadow:0 1px 3px rgba(0,0,0,0.1)}
.small{font-size:13px}
.muted{color:#64748b}

/* 导航栏 */
.navbar{position:sticky;top:0;z-index:10;background:#0f172a;color:#e5e7eb;border-bottom:1px solid rgba(255,255,255,.08);padding:8px 14px;margin-bottom:12px}
.navbar h1{font-size:24px;font-weight:700;color:#f1f5f9;margin:0}
.iconbar{display:flex;gap:10px;align-items:center}
.icon-btn{background:transparent;border:none;padding:4px;color:#e5e7eb;font-size:18px;cursor:pointer;transition:all 0.2s}
.icon-btn:hover{filter:brightness(1.2)}
.icon-btn.active{background:rgba(96,165,250,.18);border-color:#60a5fa;color:#fff}

/* 按钮样式 */
.btn{background:#3b82f6;color:white;border:none;border-radius:6px;padding:8px 16px;cursor:pointer;font-size:14px;transition:all 0.2s}
.btn:hover{background:#2563eb}
.btn.sec{background:#f1f5f9;color:#475569;border:1px solid #e2e8f0}
.btn.sec:hover{background:#e2e8f0}
.btn.warn{background:#ef4444;color:white}
.btn.warn:hover{background:#dc2626}
.btn:disabled{opacity:0.5;cursor:not-allowed}
.btn-small{padding:4px 8px;font-size:12px;border:1px solid #d1d5db;border-radius:4px;background:#fff;color:#374151;cursor:pointer;transition:all 0.2s}
.btn-small:hover{background:#f9fafb;border-color:#9ca3af}

/* 表单元素 */
input,select,textarea{border:1px solid #d1d5db;border-radius:6px;padding:8px 12px;font-size:14px;width:100%}
input:focus,select:focus,textarea:focus{outline:none;border-color:#3b82f6;box-shadow:0 0 0 3px rgba(59,130,246,0.1)}
.field{display:flex;flex-direction:column;gap:4px}
.field label{font-size:12px;font-weight:500;color:#374151}

/* 标签页样式 */
.tab-nav{display:flex;border-bottom:1px solid #e2e8f0;margin-bottom:16px}
.tab-btn{padding:8px 16px;border:none;background:none;color:#64748b;border-bottom:2px solid transparent;cursor:pointer;font-weight:500;transition:all 0.2s}
.tab-btn:hover{color:#3b82f6;background:#f1f5f9}
.tab-btn.active{color:#3b82f6;border-bottom-color:#3b82f6}
.tab-content{display:none}
.tab-content.active{display:block}

/* 日历样式 */
.calendar{background:white;border-radius:8px;overflow:hidden}
.calendar-header{background:#3b82f6;color:white;padding:16px;display:flex;align-items:center;justify-content:space-between}
.calendar-nav{background:transparent;border:none;color:white;font-size:18px;cursor:pointer;padding:4px 8px;border-radius:4px;transition:all 0.2s}
.calendar-nav:hover{background:rgba(255,255,255,0.1)}
.calendar-grid{display:grid;grid-template-columns:repeat(7,1fr)}
.calendar-day-header{background:#f8fafc;padding:12px 8px;text-align:center;font-weight:600;color:#475569;font-size:12px}
.calendar-day{padding:12px 8px;text-align:center;border:1px solid #f1f5f9;cursor:pointer;transition:all 0.2s;position:relative;min-height:60px;display:flex;flex-direction:column;align-items:center;justify-content:center}
.calendar-day:hover{background:#f8fafc}
.calendar-day.other-month{color:#94a3b8;background:#fafafa}
.calendar-day.today{background:#eff6ff;border-color:#3b82f6;font-weight:600}
.calendar-day.win{background:#dcfce7;color:#166534}
.calendar-day.loss{background:#fee2e2;color:#991b1b}
.calendar-day-number{font-size:14px;margin-bottom:4px}
.calendar-day-status{font-size:10px;padding:2px 4px;border-radius:3px;background:rgba(0,0,0,0.1)}

/* 统计图表样式 */
.stats-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:16px;margin-bottom:20px}
.stat-card{background:white;border-radius:8px;padding:16px;text-align:center;box-shadow:0 1px 3px rgba(0,0,0,0.1)}
.stat-number{font-size:24px;font-weight:700;color:#3b82f6;margin-bottom:4px}
.stat-label{font-size:12px;color:#64748b;text-transform:uppercase;letter-spacing:0.5px}
.chart-container{background:white;border-radius:8px;padding:20px;margin-bottom:20px}

/* 来源管理样式 */
.source-item{border:1px solid #e2e8f0;border-radius:6px;padding:12px;margin-bottom:8px;transition:all 0.2s}
.source-item:hover{border-color:#3b82f6;background:#f8fafc}
.source-header{display:flex;align-items:center;justify-content:space-between;margin-bottom:8px}
.source-name{font-weight:600;color:#1e293b}
.source-description{font-size:12px;color:#64748b;line-height:1.4}
.source-actions{display:flex;gap:4px}

/* 响应式设计 */
@media(max-width:768px){
  .stats-grid{grid-template-columns:repeat(2,1fr)}
  .calendar-day{min-height:50px;padding:8px 4px}
  .calendar-day-number{font-size:12px}
  .tab-nav{flex-wrap:wrap}
  .tab-btn{flex:1;min-width:120px}
}

@media(max-width:480px){
  .stats-grid{grid-template-columns:1fr}
  .calendar-grid{font-size:12px}
  .calendar-day{min-height:40px;padding:6px 2px}
}
</style>
</head>
<body>

<!-- 导航栏 -->
<div class="navbar">
  <div class="wrap">
    <div class="row" style="align-items:center;gap:12px">
      <h1>📊 预测来源记录验证</h1>
      <div class="iconbar">
        <button class="icon-btn" title="单场彩" onclick="window.location.href='index.html'">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><path d="M12 6v6l4 2"/></svg>
        </button>
        <button class="icon-btn" title="多重彩" onclick="window.location.href='multi-bet.html'">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="3" width="18" height="18" rx="2" ry="2"/><path d="M9 9h6v6H9z"/><path d="M9 3v6"/><path d="M21 9h-6"/><path d="M15 21v-6"/><path d="M3 15h6"/></svg>
        </button>
        <button class="icon-btn active" title="预测来源记录验证">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M9 11H5a2 2 0 0 0-2 2v3a2 2 0 0 0 2 2h4"/><path d="M20 16V7a2 2 0 0 0-2-2H9a2 2 0 0 0-2 2v1"/><path d="M15 2v5"/><path d="M9 2v5"/><path d="M3 9h18"/><circle cx="16" cy="16" r="2"/><path d="m21 21-1.5-1.5"/></svg>
        </button>
      </div>
    </div>
  </div>
</div>

<!-- 主要内容区域 -->
<div class="wrap">
  <div class="card">
    <!-- 标签页导航 -->
    <div class="tab-nav">
      <button class="tab-btn active" data-tab="sources">📝 预测来源管理</button>
      <button class="tab-btn" data-tab="calendar">📅 日历记录</button>
      <button class="tab-btn" data-tab="statistics">📊 统计报表</button>
    </div>

    <!-- 预测来源管理标签页 -->
    <div class="tab-content active" id="sources">
      <div class="row" style="gap:16px">
        <!-- 左侧：添加新来源 -->
        <div class="col" style="flex:1">
          <div class="card">
            <h3 style="margin:0 0 16px;color:#334155">➕ 添加新预测来源</h3>
            <div class="field" style="margin-bottom:12px">
              <label>来源名称 <span style="color:#ef4444">*</span></label>
              <input id="sourceName" placeholder="如：专家A、网站B、自己分析等">
            </div>
            <div class="field" style="margin-bottom:16px">
              <label>详细说明</label>
              <textarea id="sourceDescription" rows="4" placeholder="描述该预测来源的特点、准确率、分析方法等详细信息..."></textarea>
            </div>
            <div class="row">
              <button id="addSourceBtn" class="btn">保存来源</button>
              <button id="clearSourceForm" class="btn sec">清空</button>
            </div>
          </div>
        </div>
        
        <!-- 右侧：现有来源列表 -->
        <div class="col" style="flex:2">
          <div class="card">
            <h3 style="margin:0 0 16px;color:#334155">📋 现有预测来源</h3>
            <div id="sourcesList">
              <!-- 来源列表将在这里动态生成 -->
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- 日历记录标签页 -->
    <div class="tab-content" id="calendar">
      <div class="row" style="gap:16px;margin-bottom:16px">
        <div class="field" style="flex:1">
          <label>选择预测来源</label>
          <select id="calendarSourceSelect">
            <option value="">请选择预测来源</option>
          </select>
        </div>
        <div class="field" style="flex:1">
          <label>快速操作</label>
          <div class="row">
            <button id="markWinBtn" class="btn" style="background:#22c55e">标记今日为赢</button>
            <button id="markLossBtn" class="btn" style="background:#ef4444">标记今日为输</button>
          </div>
        </div>
      </div>
      
      <div class="calendar" id="calendar">
        <div class="calendar-header">
          <button class="calendar-nav" id="prevMonth">‹</button>
          <h3 id="currentMonth" style="margin:0;font-size:18px">2024年1月</h3>
          <button class="calendar-nav" id="nextMonth">›</button>
        </div>
        <div class="calendar-grid" id="calendarGrid">
          <!-- 日历网格将在这里动态生成 -->
        </div>
      </div>
    </div>

    <!-- 统计报表标签页 -->
    <div class="tab-content" id="statistics">
      <div class="row" style="margin-bottom:16px">
        <div class="field" style="flex:1">
          <label>选择预测来源</label>
          <select id="statsSourceSelect">
            <option value="">请选择预测来源</option>
          </select>
        </div>
        <div class="field" style="flex:1">
          <label>统计时间范围</label>
          <select id="statsTimeRange">
            <option value="30">最近30天</option>
            <option value="90">最近90天</option>
            <option value="180">最近半年</option>
            <option value="365">最近一年</option>
            <option value="all">全部时间</option>
          </select>
        </div>
      </div>
      
      <!-- 统计卡片 -->
      <div class="stats-grid" id="statsGrid">
        <div class="stat-card">
          <div class="stat-number" id="totalDays">0</div>
          <div class="stat-label">总预测天数</div>
        </div>
        <div class="stat-card">
          <div class="stat-number" id="winDays">0</div>
          <div class="stat-label">预测正确天数</div>
        </div>
        <div class="stat-card">
          <div class="stat-number" id="lossDays">0</div>
          <div class="stat-label">预测错误天数</div>
        </div>
        <div class="stat-card">
          <div class="stat-number" id="winRate">0%</div>
          <div class="stat-label">预测准确率</div>
        </div>
        <div class="stat-card">
          <div class="stat-number" id="currentStreak">0</div>
          <div class="stat-label">当前连续天数</div>
        </div>
        <div class="stat-card">
          <div class="stat-number" id="bestStreak">0</div>
          <div class="stat-label">最佳连胜记录</div>
        </div>
      </div>
      
      <!-- 图表容器 -->
      <div class="chart-container">
        <h4 style="margin:0 0 16px;color:#334155">📈 预测趋势图</h4>
        <div id="trendChart" style="height:300px;display:flex;align-items:center;justify-content:center;color:#64748b">
          请选择预测来源查看趋势图
        </div>
      </div>
      
      <div class="chart-container">
        <h4 style="margin:0 0 16px;color:#334155">📊 连胜连败分析</h4>
        <div id="streakChart" style="height:200px;display:flex;align-items:center;justify-content:center;color:#64748b">
          请选择预测来源查看连胜连败分析
        </div>
      </div>
    </div>
  </div>
</div>

<script>
// 全局变量
let predictionSources = JSON.parse(localStorage.getItem('predictionSources') || '[]');
let predictionRecords = JSON.parse(localStorage.getItem('predictionRecords') || '{}');
let currentDate = new Date();
let selectedSource = null;

// 工具函数
function $(selector) {
  return document.querySelector(selector);
}

function $$(selector) {
  return document.querySelectorAll(selector);
}

function formatDate(date) {
  return date.getFullYear() + '-' + 
         String(date.getMonth() + 1).padStart(2, '0') + '-' + 
         String(date.getDate()).padStart(2, '0');
}

function saveData() {
  localStorage.setItem('predictionSources', JSON.stringify(predictionSources));
  localStorage.setItem('predictionRecords', JSON.stringify(predictionRecords));
}

// 标签页切换
function initTabs() {
  $$('.tab-btn').forEach(btn => {
    btn.addEventListener('click', () => {
      const tabId = btn.dataset.tab;
      
      // 更新按钮状态
      $$('.tab-btn').forEach(b => b.classList.remove('active'));
      btn.classList.add('active');
      
      // 更新内容显示
      $$('.tab-content').forEach(content => {
        content.classList.remove('active');
      });
      $('#' + tabId).classList.add('active');
      
      // 根据标签页执行相应的初始化
      if (tabId === 'sources') {
        renderSourcesList();
      } else if (tabId === 'calendar') {
        updateSourceSelects();
        renderCalendar();
      } else if (tabId === 'statistics') {
        updateSourceSelects();
        updateStatistics();
      }
    });
  });
}

// 预测来源管理
function initSourcesManagement() {
  $('#addSourceBtn').addEventListener('click', addSource);
  $('#clearSourceForm').addEventListener('click', clearSourceForm);
  renderSourcesList();
}

function addSource() {
  const name = $('#sourceName').value.trim();
  const description = $('#sourceDescription').value.trim();
  
  if (!name) {
    alert('请输入来源名称');
    return;
  }
  
  // 检查是否已存在同名来源
  if (predictionSources.some(source => source.name === name)) {
    alert('该来源名称已存在，请使用其他名称');
    return;
  }
  
  const newSource = {
    id: Date.now(),
    name: name,
    description: description,
    createdAt: new Date().toISOString()
  };
  
  predictionSources.push(newSource);
  saveData();
  renderSourcesList();
  updateSourceSelects();
  clearSourceForm();
  
  alert('预测来源添加成功！');
}

function clearSourceForm() {
  $('#sourceName').value = '';
  $('#sourceDescription').value = '';
}

function renderSourcesList() {
  const container = $('#sourcesList');
  
  if (predictionSources.length === 0) {
    container.innerHTML = '<div style="text-align:center;padding:40px;color:#64748b">暂无预测来源<br><small>请先添加预测来源</small></div>';
    return;
  }
  
  container.innerHTML = predictionSources.map(source => `
    <div class="source-item">
      <div class="source-header">
        <div class="source-name">${source.name}</div>
        <div class="source-actions">
          <button class="btn-small" onclick="editSource(${source.id})">编辑</button>
          <button class="btn-small warn" onclick="deleteSource(${source.id})">删除</button>
        </div>
      </div>
      ${source.description ? `<div class="source-description">${source.description}</div>` : ''}
      <div class="small muted" style="margin-top:8px">创建时间：${new Date(source.createdAt).toLocaleString()}</div>
    </div>
  `).join('');
}

function editSource(id) {
  const source = predictionSources.find(s => s.id === id);
  if (!source) return;
  
  const newName = prompt('请输入新的来源名称：', source.name);
  if (newName === null) return;
  
  if (!newName.trim()) {
    alert('来源名称不能为空');
    return;
  }
  
  // 检查是否与其他来源重名
  if (predictionSources.some(s => s.id !== id && s.name === newName.trim())) {
    alert('该来源名称已存在，请使用其他名称');
    return;
  }
  
  const newDescription = prompt('请输入新的详细说明：', source.description || '');
  if (newDescription === null) return;
  
  source.name = newName.trim();
  source.description = newDescription.trim();
  
  saveData();
  renderSourcesList();
  updateSourceSelects();
  
  alert('预测来源更新成功！');
}

function deleteSource(id) {
  const source = predictionSources.find(s => s.id === id);
  if (!source) return;
  
  if (!confirm(`确定要删除预测来源"${source.name}"吗？\n\n注意：删除后该来源的所有预测记录也将被删除，此操作不可恢复！`)) {
    return;
  }
  
  // 删除来源
  predictionSources = predictionSources.filter(s => s.id !== id);
  
  // 删除相关的预测记录
  Object.keys(predictionRecords).forEach(date => {
    if (predictionRecords[date][id]) {
      delete predictionRecords[date][id];
      if (Object.keys(predictionRecords[date]).length === 0) {
        delete predictionRecords[date];
      }
    }
  });
  
  saveData();
  renderSourcesList();
  updateSourceSelects();
  renderCalendar();
  updateStatistics();
  
  alert('预测来源删除成功！');
}

// 更新来源选择下拉框
function updateSourceSelects() {
  const selects = ['#calendarSourceSelect', '#statsSourceSelect'];
  
  selects.forEach(selector => {
    const select = $(selector);
    if (!select) return;
    
    const currentValue = select.value;
    select.innerHTML = '<option value="">请选择预测来源</option>' + 
      predictionSources.map(source => 
        `<option value="${source.id}">${source.name}</option>`
      ).join('');
    
    // 恢复之前的选择
    if (currentValue && predictionSources.some(s => s.id == currentValue)) {
      select.value = currentValue;
    }
  });
}

// 日历功能
function initCalendar() {
  $('#prevMonth').addEventListener('click', () => {
    currentDate.setMonth(currentDate.getMonth() - 1);
    renderCalendar();
  });
  
  $('#nextMonth').addEventListener('click', () => {
    currentDate.setMonth(currentDate.getMonth() + 1);
    renderCalendar();
  });
  
  $('#calendarSourceSelect').addEventListener('change', (e) => {
    selectedSource = e.target.value ? parseInt(e.target.value) : null;
    renderCalendar();
  });
  
  $('#markWinBtn').addEventListener('click', () => markToday('win'));
  $('#markLossBtn').addEventListener('click', () => markToday('loss'));
  
  renderCalendar();
}

function markToday(result) {
  if (!selectedSource) {
    alert('请先选择预测来源');
    return;
  }
  
  const today = formatDate(new Date());
  setDayResult(today, selectedSource, result);
  renderCalendar();
  updateStatistics();
}

function renderCalendar() {
  const year = currentDate.getFullYear();
  const month = currentDate.getMonth();
  
  // 更新月份标题
  $('#currentMonth').textContent = `${year}年${month + 1}月`;
  
  // 获取月份信息
  const firstDay = new Date(year, month, 1);
  const lastDay = new Date(year, month + 1, 0);
  const startDate = new Date(firstDay);
  startDate.setDate(startDate.getDate() - firstDay.getDay());
  
  const grid = $('#calendarGrid');
  grid.innerHTML = '';
  
  // 添加星期标题
  const weekdays = ['日', '一', '二', '三', '四', '五', '六'];
  weekdays.forEach(day => {
    const header = document.createElement('div');
    header.className = 'calendar-day-header';
    header.textContent = day;
    grid.appendChild(header);
  });
  
  // 添加日期
  const today = new Date();
  const todayStr = formatDate(today);
  
  for (let i = 0; i < 42; i++) {
    const date = new Date(startDate);
    date.setDate(startDate.getDate() + i);
    const dateStr = formatDate(date);
    
    const dayElement = document.createElement('div');
    dayElement.className = 'calendar-day';
    
    // 添加样式类
    if (date.getMonth() !== month) {
      dayElement.classList.add('other-month');
    }
    if (dateStr === todayStr) {
      dayElement.classList.add('today');
    }
    
    // 获取该日期的预测结果
    let dayResult = null;
    if (selectedSource && predictionRecords[dateStr] && predictionRecords[dateStr][selectedSource]) {
      dayResult = predictionRecords[dateStr][selectedSource];
      dayElement.classList.add(dayResult);
    }
    
    // 添加日期内容
    dayElement.innerHTML = `
      <div class="calendar-day-number">${date.getDate()}</div>
      ${dayResult ? `<div class="calendar-day-status">${dayResult === 'win' ? '赢' : '输'}</div>` : ''}
    `;
    
    // 添加点击事件
    dayElement.addEventListener('click', () => {
      if (!selectedSource) {
        alert('请先选择预测来源');
        return;
      }
      
      const currentResult = predictionRecords[dateStr] && predictionRecords[dateStr][selectedSource];
      let newResult;
      
      if (!currentResult) {
        newResult = 'win';
      } else if (currentResult === 'win') {
        newResult = 'loss';
      } else {
        newResult = null; // 清除记录
      }
      
      setDayResult(dateStr, selectedSource, newResult);
      renderCalendar();
      updateStatistics();
    });
    
    grid.appendChild(dayElement);
  }
}

function setDayResult(dateStr, sourceId, result) {
  if (!predictionRecords[dateStr]) {
    predictionRecords[dateStr] = {};
  }
  
  if (result === null) {
    delete predictionRecords[dateStr][sourceId];
    if (Object.keys(predictionRecords[dateStr]).length === 0) {
      delete predictionRecords[dateStr];
    }
  } else {
    predictionRecords[dateStr][sourceId] = result;
  }
  
  saveData();
}

// 统计功能
function initStatistics() {
  $('#statsSourceSelect').addEventListener('change', updateStatistics);
  $('#statsTimeRange').addEventListener('change', updateStatistics);
  updateStatistics();
}

function updateStatistics() {
  const sourceId = $('#statsSourceSelect').value;
  const timeRange = $('#statsTimeRange').value;
  
  if (!sourceId) {
    // 清空统计显示
    $('#totalDays').textContent = '0';
    $('#winDays').textContent = '0';
    $('#lossDays').textContent = '0';
    $('#winRate').textContent = '0%';
    $('#currentStreak').textContent = '0';
    $('#bestStreak').textContent = '0';
    $('#trendChart').innerHTML = '请选择预测来源查看趋势图';
    $('#streakChart').innerHTML = '请选择预测来源查看连胜连败分析';
    return;
  }
  
  // 获取时间范围
  const endDate = new Date();
  let startDate;
  if (timeRange === 'all') {
    startDate = new Date('2020-01-01'); // 足够早的日期
  } else {
    startDate = new Date();
    startDate.setDate(startDate.getDate() - parseInt(timeRange));
  }
  
  // 收集该来源在时间范围内的记录
  const records = [];
  Object.keys(predictionRecords).forEach(dateStr => {
    const date = new Date(dateStr);
    if (date >= startDate && date <= endDate && predictionRecords[dateStr][sourceId]) {
      records.push({
        date: dateStr,
        result: predictionRecords[dateStr][sourceId]
      });
    }
  });
  
  // 按日期排序
  records.sort((a, b) => a.date.localeCompare(b.date));
  
  // 计算统计数据
  const totalDays = records.length;
  const winDays = records.filter(r => r.result === 'win').length;
  const lossDays = records.filter(r => r.result === 'loss').length;
  const winRate = totalDays > 0 ? Math.round((winDays / totalDays) * 100) : 0;
  
  // 计算连胜连败
  let currentStreak = 0;
  let bestWinStreak = 0;
  let bestLossStreak = 0;
  let tempWinStreak = 0;
  let tempLossStreak = 0;
  
  for (let i = records.length - 1; i >= 0; i--) {
    const result = records[i].result;
    
    // 计算当前连续（从最新记录开始）
    if (i === records.length - 1) {
      currentStreak = 1;
    } else if (records[i + 1].result === result) {
      currentStreak++;
    } else {
      break;
    }
  }
  
  // 计算最佳连胜连败
  records.forEach(record => {
    if (record.result === 'win') {
      tempWinStreak++;
      tempLossStreak = 0;
      bestWinStreak = Math.max(bestWinStreak, tempWinStreak);
    } else {
      tempLossStreak++;
      tempWinStreak = 0;
      bestLossStreak = Math.max(bestLossStreak, tempLossStreak);
    }
  });
  
  // 更新显示
  $('#totalDays').textContent = totalDays;
  $('#winDays').textContent = winDays;
  $('#lossDays').textContent = lossDays;
  $('#winRate').textContent = winRate + '%';
  
  // 显示当前连续状态
  if (records.length > 0) {
    const lastResult = records[records.length - 1].result;
    $('#currentStreak').textContent = currentStreak + (lastResult === 'win' ? '连胜' : '连败');
  } else {
    $('#currentStreak').textContent = '0';
  }
  
  $('#bestStreak').textContent = Math.max(bestWinStreak, bestLossStreak) + (bestWinStreak >= bestLossStreak ? '连胜' : '连败');
  
  // 更新图表
  updateCharts(records);
}

function updateCharts(records) {
  // 简单的文本图表显示
  const trendChart = $('#trendChart');
  const streakChart = $('#streakChart');
  
  if (records.length === 0) {
    trendChart.innerHTML = '暂无数据';
    streakChart.innerHTML = '暂无数据';
    return;
  }
  
  // 趋势图：显示最近的记录
  const recentRecords = records.slice(-30); // 最近30条记录
  const trendHtml = recentRecords.map(record => {
    const color = record.result === 'win' ? '#22c55e' : '#ef4444';
    const symbol = record.result === 'win' ? '●' : '●';
    return `<span style="color:${color};margin:0 2px;font-size:16px" title="${record.date}: ${record.result === 'win' ? '赢' : '输'}">${symbol}</span>`;
  }).join('');
  
  trendChart.innerHTML = `
    <div style="text-align:center">
      <div style="margin-bottom:10px;color:#64748b;font-size:12px">最近${recentRecords.length}天预测结果（绿色=赢，红色=输）</div>
      <div style="line-height:1.5">${trendHtml}</div>
    </div>
  `;
  
  // 连胜连败分析
  const streaks = [];
  let currentStreak = { type: records[0].result, count: 1, start: records[0].date };
  
  for (let i = 1; i < records.length; i++) {
    if (records[i].result === currentStreak.type) {
      currentStreak.count++;
    } else {
      currentStreak.end = records[i - 1].date;
      streaks.push(currentStreak);
      currentStreak = { type: records[i].result, count: 1, start: records[i].date };
    }
  }
  currentStreak.end = records[records.length - 1].date;
  streaks.push(currentStreak);
  
  // 显示最长的几个连胜连败
  const topStreaks = streaks
    .sort((a, b) => b.count - a.count)
    .slice(0, 5)
    .map(streak => {
      const color = streak.type === 'win' ? '#22c55e' : '#ef4444';
      const text = streak.type === 'win' ? '连胜' : '连败';
      return `<div style="margin:4px 0;padding:4px 8px;background:${color}20;border-left:3px solid ${color};border-radius:3px">
        <strong>${streak.count}${text}</strong> 
        <span style="color:#64748b;font-size:12px">(${streak.start} ~ ${streak.end})</span>
      </div>`;
    }).join('');
  
  streakChart.innerHTML = topStreaks || '<div style="color:#64748b">暂无连胜连败记录</div>';
}

// 初始化
document.addEventListener('DOMContentLoaded', function() {
  initTabs();
  initSourcesManagement();
  initCalendar();
  initStatistics();
  updateSourceSelects();
});
</script>

</body>
</html>